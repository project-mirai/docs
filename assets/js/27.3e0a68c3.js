(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{398:function(a,n,e){"use strict";e.r(n);var t=e(49),s=Object(t.a)({},(function(){var a=this,n=a.$createElement,e=a._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"mirai-console-backend-commands"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mirai-console-backend-commands"}},[a._v("#")]),a._v(" Mirai Console Backend - Commands")]),a._v(" "),e("h2",{attrs:{id:"command"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#command"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/Command.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("Command")]),e("OutboundLink")],1)]),a._v(" "),e("blockquote",[e("p",[a._v('「指令」：目前通常是 "/commandName arg1 arg2 arg3" 格式的消息。在将来可能会被扩展')])]),a._v(" "),e("div",{staticClass:"language-kotlin line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-kotlin"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("interface")]),a._v(" Command "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" names"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Array"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("out")]),a._v(" String"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" usage"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" String\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" description"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" String\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" permission"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" CommandPermission\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" prefixOptional"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Boolean\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" owner"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" CommandOwner\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("suspend")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" CommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("onCommand")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("args"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" MessageChain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br")])]),e("p",[a._v("每一条指令都被抽象成 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/Command.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("Command")]),e("OutboundLink")],1),a._v("。")]),a._v(" "),e("h3",{attrs:{id:"执行指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#执行指令"}},[a._v("#")]),a._v(" 执行指令")]),a._v(" "),e("p",[a._v("指令既可以在代码执行，也可以在消息环境中执行。")]),a._v(" "),e("h4",{attrs:{id:"在-commandmanager-执行指令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-commandmanager-执行指令"}},[a._v("#")]),a._v(" 在 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CommandManager.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandManager")]),e("OutboundLink")],1),a._v(" 执行指令")]),a._v(" "),e("p",[a._v("通过扩展：")]),a._v(" "),e("ul",[e("li",[e("code",[a._v("suspend fun Command.execute(CommandSender, args: Message, checkPermission: Boolean=true): CommandExecutionResult")])]),a._v(" "),e("li",[e("code",[a._v("suspend fun Command.execute(CommandSender, args: String, checkPermission: Boolean=true): CommandExecutionResult")])]),a._v(" "),e("li",[e("code",[a._v("suspend fun CommandSender.executeCommand(message: Message, checkPermission: Boolean=true): CommandExecutionResult")])]),a._v(" "),e("li",[e("code",[a._v("suspend fun CommandSender.executeCommand(message: String, checkPermission: Boolean=true): CommandExecutionResult")])])]),a._v(" "),e("h3",{attrs:{id:"指令语法解析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#指令语法解析"}},[a._v("#")]),a._v(" 指令语法解析")]),a._v(" "),e("p",[a._v("一条消息可以被解析为指令，如果它满足:")]),a._v(" "),e("p",[e("code",[a._v("<指令前缀><任一指令名> <指令参数列表>")])]),a._v(" "),e("p",[a._v("指令参数由空格分隔。参数类型可能为 "),e("code",[a._v("MessageContent")]),a._v(" 类型，或 "),e("code",[a._v("String")]),a._v("（被包装为 "),e("code",[a._v("PlainText")]),a._v(")")]),a._v(" "),e("p",[a._v("指令前缀可能是可选的。可以在配置文件配置。（计划支持中）")]),a._v(" "),e("h3",{attrs:{id:"rawcommand"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rawcommand"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/RawCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("RawCommand")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("无参数解析, 接收原生参数的指令。")]),a._v(" "),e("div",{staticClass:"language-kotlin line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-kotlin"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("abstract")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("override")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("suspend")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" CommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("onCommand")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("args"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" MessageChain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("p",[a._v("例如 "),e("code",[a._v("/test 123 [图片]")]),a._v("，在处理时 "),e("code",[a._v("onCommand")]),a._v(" 接收的 "),e("code",[a._v("args")]),a._v(" 为包含 2 个元素的 "),e("code",[a._v("MessageChain")]),a._v("。第一个元素为 "),e("code",[a._v('PlainText("123")')]),a._v("，第二个元素为 "),e("code",[a._v("Image")]),a._v(" 类型。")]),a._v(" "),e("h3",{attrs:{id:"register"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#register"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CommandManager.kt#L77",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("Register")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("需要把指令注册到 "),e("code",[a._v("CommandManager")]),a._v(" 以在 Mirai Console 生效")]),a._v(" "),e("div",{staticClass:"language-kotlin line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-kotlin"}},[e("code",[a._v("CommandManager"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("registerCommand")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("command"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br")])]),e("h2",{attrs:{id:"参数智能解析"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数智能解析"}},[a._v("#")]),a._v(" 参数智能解析")]),a._v(" "),e("blockquote",[e("p",[a._v("本节可能较难理解。但这不会影响你阅读下面的示例。")])]),a._v(" "),e("p",[a._v("Mirai Console 为了简化处理指令时的解析过程，设计了参数智能解析。")]),a._v(" "),e("h3",{attrs:{id:"commandvalueargumentparser"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commandvalueargumentparser"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandValueArgumentParser.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandValueArgumentParser")]),e("OutboundLink")],1)]),a._v(" "),e("div",{staticClass:"language-kotlin line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-kotlin"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("interface")]),a._v(" CommandArgumentParser"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("out")]),a._v(" T "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Any"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("parse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("raw"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" sender"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" CommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" T\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("parse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("raw"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" MessageContent"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" sender"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" CommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" T "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("parse")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("raw"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("content"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" sender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br")])]),e("p",[a._v("用于解析一个参数到一个数据类型。")]),a._v(" "),e("h3",{attrs:{id:"commandargumentcontext"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commandargumentcontext"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandArgumentContext.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandArgumentContext")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("是 "),e("code",[a._v("Class")]),a._v(" 到 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandValueArgumentParser.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandValueArgumentParser")]),e("OutboundLink")],1),a._v(" 的映射。作用是为某一个类型分配解析器。")]),a._v(" "),e("h4",{attrs:{id:"内建-commandargumentcontext"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#内建-commandargumentcontext"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandArgumentContext.kt#L66",target:"_blank",rel:"noopener noreferrer"}},[a._v("内建 "),e("code",[a._v("CommandArgumentContext")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("支持原生数据类型，"),e("code",[a._v("Contact")]),a._v(" 及其子类，"),e("code",[a._v("Bot")]),a._v("。")]),a._v(" "),e("h4",{attrs:{id:"构建-commandargumentcontext"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#构建-commandargumentcontext"}},[a._v("#")]),a._v(" 构建 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandArgumentContext.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandArgumentContext")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("查看源码内注释："),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandArgumentContext.kt#L146-L183",target:"_blank",rel:"noopener noreferrer"}},[a._v("CommandArgumentContext.kt: Line 146"),e("OutboundLink")],1)]),a._v(" "),e("h3",{attrs:{id:"支持参数解析的-command-实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#支持参数解析的-command-实现"}},[a._v("#")]),a._v(" 支持参数解析的 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/Command.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("Command")]),e("OutboundLink")],1),a._v(" 实现")]),a._v(" "),e("p",[a._v("Mirai Console 内建 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/SimpleCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("SimpleCommand")]),e("OutboundLink")],1),a._v(" 与 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CompositeCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CompositeCommand")]),e("OutboundLink")],1),a._v(" 拥有 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandArgumentContext.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandArgumentContext")]),e("OutboundLink")],1),a._v("，在处理参数时会首先解析参数再传递给插件的实现。")]),a._v(" "),e("h3",{attrs:{id:"simplecommand"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#simplecommand"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/SimpleCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("SimpleCommand")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("简单指令。")]),a._v(" "),e("p",[a._v("此时示例一定比理论有意义。")]),a._v(" "),e("div",{staticClass:"language-kotlin line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-kotlin"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("object")]),a._v(" MySimpleCommand "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("SimpleCommand")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    MyPluginMain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"tell"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"私聊"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    description "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Tell somebody privately"')]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token annotation builtin"}},[a._v("@Handler")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 标记这是指令处理器  // 函数名随意 ")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("suspend")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" CommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("handle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("target"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" User"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" message"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 这两个参数会被作为指令参数要求")]),a._v("\n        target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sendMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("message"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br")])]),e("p",[a._v("指令 "),e("code",[a._v("/tell 123456 Hello")]),a._v(" 的解析流程:")]),a._v(" "),e("ol",[e("li",[a._v("被分割为 "),e("code",[a._v("/")]),a._v(", "),e("code",[a._v('"tell"')]),a._v(", "),e("code",[a._v('"123456"')]),a._v(", "),e("code",[a._v('"Hello"')])]),a._v(" "),e("li",[e("code",[a._v("MySimpleCommand")]),a._v(" 被匹配到，根据 "),e("code",[a._v("/")]),a._v(" 和 "),e("code",[a._v('"test"')]),a._v("。"),e("code",[a._v('"123456"')]),a._v(", "),e("code",[a._v('"Hello"')]),a._v(" 被作为指令的原生参数。")]),a._v(" "),e("li",[a._v("由于 "),e("code",[a._v("MySimpleCommand")]),a._v(" 定义的 "),e("code",[a._v("handle")]),a._v(" 需要两个参数, "),e("code",[a._v("User")]),a._v(" 和 "),e("code",[a._v("String")]),a._v("，"),e("code",[a._v('"123456"')]),a._v(" 需要转换成 "),e("code",[a._v("User")]),a._v("，"),e("code",[a._v('"Hello"')]),a._v(" 需要转换成 "),e("code",[a._v("String")]),a._v("。")]),a._v(" "),e("li",[a._v("Console 在 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandArgumentContext.kt#L66",target:"_blank",rel:"noopener noreferrer"}},[a._v("内建 "),e("code",[a._v("CommandArgumentContext")]),e("OutboundLink")],1),a._v(" 寻找适合于 "),e("code",[a._v("User")]),a._v(" 的 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandValueArgumentParser.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandValueArgumentParser")]),e("OutboundLink")],1)]),a._v(" "),e("li",[e("code",[a._v('"123456"')]),a._v(" 被传入这个 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/descriptor/CommandValueArgumentParser.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandValueArgumentParser")]),e("OutboundLink")],1),a._v("，得到 "),e("code",[a._v("User")])]),a._v(" "),e("li",[e("code",[a._v('"Hello"')]),a._v(" 也会按照 4~5 的步骤转换为 "),e("code",[a._v("String")]),a._v(" 类型的参数")]),a._v(" "),e("li",[a._v("解析完成的参数被传入 "),e("code",[a._v("handle")])])]),a._v(" "),e("h2",{attrs:{id:"compositecommand"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#compositecommand"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CompositeCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CompositeCommand")]),e("OutboundLink")],1)]),a._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CompositeCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CompositeCommand")]),e("OutboundLink")],1),a._v(" 的参数解析与 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/SimpleCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("SimpleCommand")]),e("OutboundLink")],1),a._v(" 一样，只是多了「子指令」概念。")]),a._v(" "),e("p",[a._v("示例：")]),a._v(" "),e("div",{staticClass:"language-kotlin line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-kotlin"}},[e("code",[e("span",{pre:!0,attrs:{class:"token annotation builtin"}},[a._v("@OptIn")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ConsoleExperimentalAPI"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("object")]),a._v(" MyCompositeCommand "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("CompositeCommand")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    MyPluginMain"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"manage"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// "manage" 是主指令名')]),a._v("\n    description "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"示例指令"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" permission "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" MyCustomPermission"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// prefixOptional = true // 还有更多参数可填, 此处忽略")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// [参数智能解析]")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// 在控制台执行 "/manage <群号>.<群员> <持续时间>",')]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// 或在聊天群内发送 "/manage <@一个群员> <持续时间>",')]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// 或在聊天群内发送 "/manage <目标群员的群名> <持续时间>",')]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// 或在聊天群内发送 "/manage <目标群员的账号> <持续时间>"')]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 时调用这个函数")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token annotation builtin"}},[a._v("@SubCommand")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 表示这是一个子指令，使用函数名作为子指令名称")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("suspend")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" CommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mute")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("target"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Member"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" duration"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Int"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 通过 /manage mute <target> <duration> 调用")]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sendMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/manage mute 被调用了, 参数为: '),e("span",{pre:!0,attrs:{class:"token interpolation variable"}},[a._v("$target")]),a._v(", "),e("span",{pre:!0,attrs:{class:"token interpolation variable"}},[a._v("$duration")]),a._v('"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" result "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" kotlin"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("runCatching")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            target"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("mute")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("duration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("toString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("getOrElse")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            it"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("stackTraceToString")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 失败时返回堆栈信息")]),a._v("\n\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sendMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"结果: '),e("span",{pre:!0,attrs:{class:"token interpolation variable"}},[a._v("$result")]),a._v('"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    \n    "),e("span",{pre:!0,attrs:{class:"token annotation builtin"}},[a._v("@SubCommand")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("suspend")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" ConsoleCommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("foo")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 使用 ConsoleCommandSender 作为接收者，表示指令只能由控制台执行。")]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 当用户尝试在聊天环境执行时将会收到错误提示。")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token annotation builtin"}},[a._v("@SubCommand")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"list"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"查看列表"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 可以设置多个子指令名。此时函数名会被忽略。")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("suspend")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" CommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("ignoredFunctionName")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// 执行 "/manage list" 时调用这个函数')]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sendMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/manage list 被调用了"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 支持 Image 类型, 需在聊天中执行此指令.")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token annotation builtin"}},[a._v("@SubCommand")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("suspend")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" UserCommandSender"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("test")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("image"),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Image"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// 执行 "/manage test <一张图片>" 时调用这个函数')]),a._v("\n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 由于 Image 类型消息只可能在聊天环境，可以直接使用 UserCommandSender。")]),a._v("\n        \n        "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sendMessage")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/manage image 被调用了, 图片是 '),e("span",{pre:!0,attrs:{class:"token interpolation"}},[e("span",{pre:!0,attrs:{class:"token delimiter variable"}},[a._v("${")]),a._v("image"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("imageId"),e("span",{pre:!0,attrs:{class:"token delimiter variable"}},[a._v("}")])]),a._v('"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br"),e("span",{staticClass:"line-number"},[a._v("26")]),e("br"),e("span",{staticClass:"line-number"},[a._v("27")]),e("br"),e("span",{staticClass:"line-number"},[a._v("28")]),e("br"),e("span",{staticClass:"line-number"},[a._v("29")]),e("br"),e("span",{staticClass:"line-number"},[a._v("30")]),e("br"),e("span",{staticClass:"line-number"},[a._v("31")]),e("br"),e("span",{staticClass:"line-number"},[a._v("32")]),e("br"),e("span",{staticClass:"line-number"},[a._v("33")]),e("br"),e("span",{staticClass:"line-number"},[a._v("34")]),e("br"),e("span",{staticClass:"line-number"},[a._v("35")]),e("br"),e("span",{staticClass:"line-number"},[a._v("36")]),e("br"),e("span",{staticClass:"line-number"},[a._v("37")]),e("br"),e("span",{staticClass:"line-number"},[a._v("38")]),e("br"),e("span",{staticClass:"line-number"},[a._v("39")]),e("br"),e("span",{staticClass:"line-number"},[a._v("40")]),e("br"),e("span",{staticClass:"line-number"},[a._v("41")]),e("br"),e("span",{staticClass:"line-number"},[a._v("42")]),e("br"),e("span",{staticClass:"line-number"},[a._v("43")]),e("br"),e("span",{staticClass:"line-number"},[a._v("44")]),e("br"),e("span",{staticClass:"line-number"},[a._v("45")]),e("br"),e("span",{staticClass:"line-number"},[a._v("46")]),e("br")])]),e("h3",{attrs:{id:"选择-rawcommand-simplecommand-或-compositecommand"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#选择-rawcommand-simplecommand-或-compositecommand"}},[a._v("#")]),a._v(" 选择 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/RawCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("RawCommand")]),e("OutboundLink")],1),a._v(", "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/SimpleCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("SimpleCommand")]),e("OutboundLink")],1),a._v(" 或 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CompositeCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CompositeCommand")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("若需要不限长度的，自由的参数列表，使用 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/RawCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("RawCommand")]),e("OutboundLink")],1),a._v("。")]),a._v(" "),e("p",[a._v("若需要子指令，使用 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CompositeCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CompositeCommand")]),e("OutboundLink")],1),a._v("。否则使用 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/SimpleCommand.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("SimpleCommand")]),e("OutboundLink")],1),a._v("。")]),a._v(" "),e("h2",{attrs:{id:"commandmanager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commandmanager"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CommandManager.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandManager")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("上面已经提到可以在 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CommandManager.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandManager")]),e("OutboundLink")],1),a._v(" 执行指令。"),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CommandManager.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandManager")]),e("OutboundLink")],1),a._v(" 持有已经注册的指令列表，源码内有详细注释，此处不过多赘述。")]),a._v(" "),e("h2",{attrs:{id:"commandsender"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#commandsender"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CommandSender.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("CommandSender")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("指令发送者。")]),a._v(" "),e("h3",{attrs:{id:"必要性"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#必要性"}},[a._v("#")]),a._v(" 必要性")]),a._v(" "),e("p",[a._v("指令可能在聊天环境执行，也可能在控制台执行。因此需要一个通用的接口表示这样的执行者。")]),a._v(" "),e("h3",{attrs:{id:"类型"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[a._v("#")]),a._v(" 类型")]),a._v(" "),e("div",{staticClass:"language-text line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("                CoroutineScope\n                       ↑\n                       |\n                 CommandSender &lt;---------+---------------+-------------------------------+\n                       ↑                 |               |                               |\n                       |                 |               |                               |\n                       |     UserCommandSender   GroupAwareCommandSender     CommandSenderOnMessage\n                       |                 ↑               ↑                               ↑\n                       |                 |               |                               |\n              AbstractCommandSender      |               |                               |\n                       ↑                 |               |                               |\n                       | sealed          |               |                               |\n         +-------------+-------------+   |               |                               |\n         |                           |   |               |                               |\n         |                           |   |               |                               |      }\nConsoleCommandSender    AbstractUserCommandSender        |                               |      } 一级子类\n                                     ↑                   |                               |      }\n                                     | sealed            |                               |\n                                     |                   |                               |\n              +----------------------+                   |                               |\n              |                      |                   |                               |\n              |                      +------+------------+---------------+               |\n              |                             |                            |               |\n              |                             |                            |               |      }\n      FriendCommandSender          MemberCommandSender           TempCommandSender       |      } 二级子类\n              ↑                             ↑                            ↑               |      }\n              |                             |                            |               |\n              |                             |                            |               |      }\n FriendCommandSenderOnMessage  MemberCommandSenderOnMessage  TempCommandSenderOnMessage  |      } 三级子类\n              |                             |                            |               |      }\n              |                             |                            |               |\n              +-----------------------------+----------------------------+---------------+\n")])]),a._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[a._v("1")]),e("br"),e("span",{staticClass:"line-number"},[a._v("2")]),e("br"),e("span",{staticClass:"line-number"},[a._v("3")]),e("br"),e("span",{staticClass:"line-number"},[a._v("4")]),e("br"),e("span",{staticClass:"line-number"},[a._v("5")]),e("br"),e("span",{staticClass:"line-number"},[a._v("6")]),e("br"),e("span",{staticClass:"line-number"},[a._v("7")]),e("br"),e("span",{staticClass:"line-number"},[a._v("8")]),e("br"),e("span",{staticClass:"line-number"},[a._v("9")]),e("br"),e("span",{staticClass:"line-number"},[a._v("10")]),e("br"),e("span",{staticClass:"line-number"},[a._v("11")]),e("br"),e("span",{staticClass:"line-number"},[a._v("12")]),e("br"),e("span",{staticClass:"line-number"},[a._v("13")]),e("br"),e("span",{staticClass:"line-number"},[a._v("14")]),e("br"),e("span",{staticClass:"line-number"},[a._v("15")]),e("br"),e("span",{staticClass:"line-number"},[a._v("16")]),e("br"),e("span",{staticClass:"line-number"},[a._v("17")]),e("br"),e("span",{staticClass:"line-number"},[a._v("18")]),e("br"),e("span",{staticClass:"line-number"},[a._v("19")]),e("br"),e("span",{staticClass:"line-number"},[a._v("20")]),e("br"),e("span",{staticClass:"line-number"},[a._v("21")]),e("br"),e("span",{staticClass:"line-number"},[a._v("22")]),e("br"),e("span",{staticClass:"line-number"},[a._v("23")]),e("br"),e("span",{staticClass:"line-number"},[a._v("24")]),e("br"),e("span",{staticClass:"line-number"},[a._v("25")]),e("br"),e("span",{staticClass:"line-number"},[a._v("26")]),e("br"),e("span",{staticClass:"line-number"},[a._v("27")]),e("br"),e("span",{staticClass:"line-number"},[a._v("28")]),e("br"),e("span",{staticClass:"line-number"},[a._v("29")]),e("br"),e("span",{staticClass:"line-number"},[a._v("30")]),e("br"),e("span",{staticClass:"line-number"},[a._v("31")]),e("br"),e("span",{staticClass:"line-number"},[a._v("32")]),e("br")])]),e("p",[a._v("有关类型的详细信息，请查看 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/command/CommandSender.kt#L48-L135",target:"_blank",rel:"noopener noreferrer"}},[a._v("CommandSender.kt"),e("OutboundLink")],1)]),a._v(" "),e("h3",{attrs:{id:"获取"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取"}},[a._v("#")]),a._v(" 获取")]),a._v(" "),e("p",[e("code",[a._v("Contact.asCommandSender()")]),a._v(" 或 "),e("code",[a._v("MessageEvent.toCommandSender()")]),a._v("，或 "),e("code",[a._v("ConsoleCommandSender")])]),a._v(" "),e("h2",{attrs:{id:"messagescope"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#messagescope"}},[a._v("#")]),a._v(" "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/util/MessageScope.kt",target:"_blank",rel:"noopener noreferrer"}},[e("code",[a._v("MessageScope")]),e("OutboundLink")],1)]),a._v(" "),e("p",[a._v("表示几个消息对象的’域‘，即消息对象的集合。用于最小化将同一条消息发送给多个类型不同的目标的付出。")]),a._v(" "),e("p",[a._v("参考 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/util/MessageScope.kt#L28-L99",target:"_blank",rel:"noopener noreferrer"}},[a._v("MessageScope"),e("OutboundLink")],1)]),a._v(" "),e("hr"),a._v(" "),e("blockquote",[e("p",[a._v("下一步，"),e("RouterLink",{attrs:{to:"/console/PluginData.html#mirai-console-backend---plugindata"}},[a._v("PluginData")])],1),a._v(" "),e("p",[a._v("返回 "),e("RouterLink",{attrs:{to:"/console/#mirai-console"}},[a._v("开发文档索引")])],1)])])}),[],!1,null,null,null);n.default=s.exports}}]);