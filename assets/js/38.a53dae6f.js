(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{414:function(t,a,s){"use strict";s.r(a);var n=s(49),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"mirai-console-backend-jvm-plugins"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mirai-console-backend-jvm-plugins"}},[t._v("#")]),t._v(" Mirai Console Backend - JVM Plugins")]),t._v(" "),s("p",[t._v("本章节介绍 JVM 平台的插件。")]),t._v(" "),s("h2",{attrs:{id:"jvm-平台插件接口-jvmplugin"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jvm-平台插件接口-jvmplugin"}},[t._v("#")]),t._v(" JVM 平台插件接口 - "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPlugin")]),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("所有的 JVM 插件（特别地，打包为 "),s("code",[t._v("JAR")]),t._v(" 的）都必须实现 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPlugin")]),s("OutboundLink")],1),t._v("，否则不会被 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPluginLoader.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPluginLoader")]),s("OutboundLink")],1),t._v("\n识别和加载。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPlugin")]),s("OutboundLink")],1),t._v(" 派生为 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/KotlinPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("KotlinPlugin")]),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JavaPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JavaPlugin")]),s("OutboundLink")],1),t._v("，其关系图如下所示。")]),t._v(" "),s("p",[s("img",{attrs:{src:"JVMPlugin_images/75227ef5.png",alt:""}})]),t._v(" "),s("p",[t._v("其中 "),s("code",[t._v("AbstractJvmPlugin")]),t._v(" 是 Console 提供的基础实现，如数据目录等。")]),t._v(" "),s("h2",{attrs:{id:"主类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主类"}},[t._v("#")]),t._v(" 主类")]),t._v(" "),s("p",[t._v("JVM 平台插件的主类应被实现为一个单例（Kotlin "),s("code",[t._v("object")]),t._v("，Java 静态初始化的类，详见下文示例）。")]),t._v(" "),s("p",[s("strong",[t._v("Kotlin 使用者的插件主类应继承 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/KotlinPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("KotlinPlugin")]),s("OutboundLink")],1),t._v("。")]),s("br"),t._v(" "),s("strong",[t._v("其他 JVM 语言（如 Java）使用者的插件主类应继承 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JavaPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JavaPlugin")]),s("OutboundLink")],1),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"定义主类"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定义主类"}},[t._v("#")]),t._v(" 定义主类")]),t._v(" "),s("p",[t._v("Mirai Console 使用类似 Java "),s("code",[t._v("ServiceLoader")]),t._v(" 但更灵活的机制加载插件。")]),t._v(" "),s("p",[t._v('一个正确的主类定义可以是以下三种任一。注意 "描述" 将会在'),s("a",{attrs:{href:"#%E6%8F%8F%E8%BF%B0"}},[t._v("下文")]),t._v("解释。")]),t._v(" "),s("ol",[s("li",[t._v("Kotlin "),s("code",[t._v("object")])])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" A "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("KotlinPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 描述 */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Java 静态初始化单例 "),s("code",[t._v("class")])])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),t._v(" INSTANCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须 public static, 必须名为 INSTANCE")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 描述 */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("Java "),s("code",[t._v("class")])])]),t._v(" "),s("p",[t._v("使用这种方法时，插件实例由 Console 在合适的时机创建。")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("A")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必须公开且无参")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* 描述 */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("h3",{attrs:{id:"确认主类正确定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#确认主类正确定义"}},[t._v("#")]),t._v(" 确认主类正确定义")]),t._v(" "),s("p",[t._v("在 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/intellij-plugin/",target:"_blank",rel:"noopener noreferrer"}},[t._v("IDE 插件"),s("OutboundLink")],1),t._v(" 的帮助下，一个正确的插件主类定义的行号处会显示 Mirai 像素风格形象图："),s("img",{attrs:{src:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/intellij-plugin/resources/icons/pluginMainDeclaration.png",alt:"MiraiPixel"}})]),t._v(" "),s("p",[s("img",{attrs:{src:"images/PluginMainDeclaration.png",alt:"PluginMainDeclaration"}})]),t._v(" "),s("h3",{attrs:{id:"配置主类服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置主类服务"}},[t._v("#")]),t._v(" 配置主类服务")]),t._v(" "),s("h4",{attrs:{id:"自动配置主类服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动配置主类服务"}},[t._v("#")]),t._v(" 自动配置主类服务")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/intellij-plugin/",target:"_blank",rel:"noopener noreferrer"}},[t._v("IDE 插件"),s("OutboundLink")],1),t._v(" 会自动检查主类服务的配置。在没有正确配置时，IDE 将会警告并为你自动配置："),s("br"),t._v(" "),s("img",{attrs:{src:"images/PluginMainServiceNotConfigured.png",alt:"PluginMainServiceNotConfigured"}})]),t._v(" "),s("h4",{attrs:{id:"手动配置主类服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#手动配置主类服务"}},[t._v("#")]),t._v(" 手动配置主类服务")]),t._v(" "),s("p",[t._v("若无法使用 IntelliJ\n插件，可在资源目录 "),s("code",[t._v("META-INF/services/net.mamoe.mirai.console.plugin.jvm.JvmPlugin")]),t._v("\n文件内存放插件主类全名（以纯文本 UTF-8 存储，文件内容只包含一行插件主类全名或以 "),s("code",[t._v("#")]),t._v(" 起始的注释）。")]),t._v(" "),s("p",[t._v("也可以使用各种自动化工具配置 service 信息，如使用 Google\n的 "),s("a",{attrs:{href:"https://github.com/google/auto/tree/master/service",target:"_blank",rel:"noopener noreferrer"}},[t._v("AutoService"),s("OutboundLink")],1),t._v("\n。附"),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/QA.md#%E4%BD%BF%E7%94%A8-autoservice",target:"_blank",rel:"noopener noreferrer"}},[t._v("在 Kotlin 使用的方法"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("blockquote",[s("p",[t._v("备注：Console 虽然使用这种常用的 service 配置方式，但不使用 ServiceLoader 加载插件实例。Console\n的加载方式更灵活。")])]),t._v(" "),s("h2",{attrs:{id:"描述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#描述"}},[t._v("#")]),t._v(" 描述")]),t._v(" "),s("p",[t._v("插件主类需要提供一份描述信息。")]),t._v(" "),s("p",[t._v("插件可以通过资源文件提供静态的信息，也可以通过构造器动态传递。")]),t._v(" "),s("p",[t._v("描述拥有如下属性：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("属性")]),t._v(" "),s("th",[t._v("可空")]),t._v(" "),s("th",[t._v("备注")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("id")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("唯一识别标识符，仅能包含英文字母、数字、"),s("code",[t._v(".")]),t._v("、"),s("code",[t._v("-")])])]),t._v(" "),s("tr",[s("td",[t._v("version")]),t._v(" "),s("td",[t._v("否")]),t._v(" "),s("td",[t._v("版本号，见补充说明")])]),t._v(" "),s("tr",[s("td",[t._v("name")]),t._v(" "),s("td",[t._v("是")]),t._v(" "),s("td",[t._v("供用户阅读的名称，可包含任意字符")])]),t._v(" "),s("tr",[s("td",[t._v("author")]),t._v(" "),s("td",[t._v("是")]),t._v(" "),s("td",[t._v("作者信息")])]),t._v(" "),s("tr",[s("td",[t._v("dependencies")]),t._v(" "),s("td",[t._v("是")]),t._v(" "),s("td",[t._v("依赖其他插件的 ID 及版本范围")])]),t._v(" "),s("tr",[s("td",[t._v("info")]),t._v(" "),s("td",[t._v("是")]),t._v(" "),s("td",[t._v("供用户阅读的描述信息")])])])]),t._v(" "),s("h3",{attrs:{id:"有关插件版本号的补充说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有关插件版本号的补充说明"}},[t._v("#")]),t._v(" 有关插件版本号的补充说明")]),t._v(" "),s("ul",[s("li",[t._v("插件自身的版本要求遵循 "),s("a",{attrs:{href:"https://semver.org/lang/zh-CN/",target:"_blank",rel:"noopener noreferrer"}},[t._v("语义化版本 2.0.0"),s("OutboundLink")],1),t._v("\n规范，合格的版本例如："),s("code",[t._v("1.0.0")]),t._v("、"),s("code",[t._v("1.0")]),t._v("、"),s("code",[t._v("1.0-M1")]),t._v("、"),s("code",[t._v("1.0-pre-1")]),t._v("；")])]),t._v(" "),s("h3",{attrs:{id:"有关插件依赖的说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有关插件依赖的说明"}},[t._v("#")]),t._v(" 有关插件依赖的说明")]),t._v(" "),s("ul",[s("li",[t._v("插件依赖的版本遵循 "),s("a",{attrs:{href:"https://semver.org/lang/zh-CN/",target:"_blank",rel:"noopener noreferrer"}},[t._v("语义化版本 2.0.0"),s("OutboundLink")],1),t._v("\n规范，同时支持 "),s("a",{attrs:{href:"http://ant.apache.org/ivy/history/latest-milestone/settings/version-matchers.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Apache Ivy 风格表示方法"),s("OutboundLink")],1),t._v("\n。")])]),t._v(" "),s("p",[t._v("在定义时需使用 ID，因为 ID 是唯一的。不支持使用名称（name）。")]),t._v(" "),s("p",[t._v("定义必须依赖 net.mamoe.chat-command：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net.mamoe.chat-command"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("定义可选依赖 net.mamoe.chat-command：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net.mamoe.chat-command?"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("定义必须依赖 1.0 及以上， 2.0 （不包含）以下的 net.mamoe.chat-command 插件：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net.mamoe.chat-command:[1.0, 2.0)"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("定义可选依赖 1.0 及以上， 2.0 （不包含）以下的 net.mamoe.chat-command 插件：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net.mamoe.chat-command:[1.0, 2.0)?"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("插件的依赖将在下文 [依赖其他插件][#依赖其他插件] 详细说明。")]),t._v(" "),s("h3",{attrs:{id:"通过资源文件提供静态信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通过资源文件提供静态信息"}},[t._v("#")]),t._v(" 通过资源文件提供静态信息")]),t._v(" "),s("p",[t._v("在资源文件目录（如 "),s("code",[t._v("src/main/resources")]),t._v("）创建 "),s("code",[t._v("plugin.yml")]),t._v("，并填写上述属性，示例：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" net.mamoe.chat"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("command\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("version")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0.3.0\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Chat Command\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("author")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Mamoe Technologies\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dependencies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者不写这行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 允许在聊天环境执行指令。\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("然后在插件主类指定从资源加载：")]),t._v(" "),s("p",[s("em",[t._v("Kotlin")])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" A "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("KotlinPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JvmPluginDescription"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadFromResource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("em",[t._v("Java")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" INSTANCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JvmPluginDescription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadFromResource")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[t._v("注意，尽管 "),s("code",[t._v("loadFromResource")]),t._v(" 支持读取任意路径的文件，但也建议使用默认的 "),s("code",[t._v("plugin.yml")]),t._v("\n。因为目前有计划修改插件信息的读取方式，这种 "),s("code",[t._v("plugin.yml")]),t._v(" 的读取方式很有可能会继续得到支持。")]),t._v(" "),s("h3",{attrs:{id:"在构造器动态提供"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#在构造器动态提供"}},[t._v("#")]),t._v(" 在构造器动态提供")]),t._v(" "),s("p",[s("em",[t._v("注意：由于目前有计划修改插件信息的读取方式，这种构造器动态提供的方法已不再推荐。")])]),t._v(" "),s("p",[t._v("在构造器动态构造 "),s("code",[t._v("JvmPluginDescription")]),t._v("：")]),t._v(" "),s("p",[s("em",[t._v("Kotlin")])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MyPlugin "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("KotlinPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("JvmPluginDescription")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必要属性")]),t._v("\n        id "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal singleline"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"net.mamoe.chat-command"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        version "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal singleline"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 非必须属性")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-literal singleline"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Chat Command"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// author("...")')]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// dependsOn("...") // 与 YAML 方式类似，如 "net.mamoe.chat-command:[1.0, 2.0)?"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[s("em",[t._v("Java")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" INSTANCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("super")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JvmPluginDescriptionBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 必要属性")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.example.test-plugin"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// id")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0.0"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// version")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("author")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可选属性，可以不提供， 直接 build")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"..."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("build")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("h2",{attrs:{id:"使用日志"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用日志"}},[t._v("#")]),t._v(" 使用日志")]),t._v(" "),s("p",[t._v("Console 为插件提供一个 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/mirai-core-api/src/commonMain/kotlin/utils/MiraiLogger.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MiraiLogger")]),s("OutboundLink")],1),t._v("：")]),t._v(" "),s("p",[s("em",[t._v("Kotlin")])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MyPluginMain "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("KotlinPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ... */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onEnable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        logger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal singleline"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"一条 INFO 级别的日志"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当日志被用户启用时才会执行 lambda 内代码并记录日志")]),t._v("\n\n        logger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("debug")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string-literal singleline"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"一条 DEBUG 级别的日志"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// DEBUG 级别")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("p",[s("em",[t._v("Java")])]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" INSTANCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onEnable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLogger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isInfoEnabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLogger")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"一条 INFO 级别的日志"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 当日志被用户启用时才会执行")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("p",[t._v("Console 的日志一共有五个级别：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("级别（由高到低）")]),t._v(" "),s("th",[t._v("用途")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("默认启用")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("ERROR")]),t._v(" "),s("td",[t._v("记录影响程序运行的错误")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("是")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("WARNING")]),t._v(" "),s("td",[t._v("记录不影响程序运行的警告")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("是")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("INFO")]),t._v(" "),s("td",[t._v("记录一条普通信息")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("是")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("DEBUG")]),t._v(" "),s("td",[t._v("记录普通调试信息")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("否")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("VERBOSE")]),t._v(" "),s("td",[t._v("记录详细调试信息")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("否")])])])]),t._v(" "),s("p",[t._v("由于 DEBUG 和 VERBOSE\n默认是禁用的，插件开发者可以自由使用这两个级别的日志来辅助进行调试工作。也可以在当用户遇到问题时，让用户单独启用这些日志来获取调试信息。")]),t._v(" "),s("p",[t._v("可以在配置 "),s("code",[t._v("config/Console/Logger.yml")]),t._v(" 中进行如下操作：")]),t._v(" "),s("h3",{attrs:{id:"调整全局日志等级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调整全局日志等级"}},[t._v("#")]),t._v(" 调整全局日志等级")]),t._v(" "),s("p",[t._v("修改 "),s("code",[t._v("defaultPriority")]),t._v("，若设置为 DEBUG，则启用上表中 DEBUG 及更高级别的日志，即\nDEBUG、INFO、WARNING、ERROR。")]),t._v(" "),s("h3",{attrs:{id:"调整特定日志等级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调整特定日志等级"}},[t._v("#")]),t._v(" 调整特定日志等级")]),t._v(" "),s("p",[t._v("每个插件被分配的 MiraiLogger 的 ID (identity) 为插件描述的名称（name）。")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("loggers")]),t._v(" 增加对名称的配置，示例（启用名为 "),s("code",[t._v("Chat Command")]),t._v(" 的插件的 DEBUG 及更高级别的日志）：")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("loggers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v('"Chat Command"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DEBUG\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br")])]),s("p",[t._v("提示：该 ID 也可以在日志中找到。如下面的日志中，"),s("code",[t._v("Bot 12345678")]),t._v(" 就是其所属 MiraiLogger 的 ID。（其前 V\n代表等级为 VERBOSE）")]),t._v(" "),s("div",{staticClass:"language-text line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("2022-05-02 11:09:28 V/Bot 12345678: Event: BotOnlineEvent(bot=Bot(12345678))\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h2",{attrs:{id:"插件生命周期与依赖管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件生命周期与依赖管理"}},[t._v("#")]),t._v(" 插件生命周期与依赖管理")]),t._v(" "),s("p",[t._v("每个 JVM 插件有如下状态：初始化、加载、启用、禁用。")]),t._v(" "),s("ul",[s("li",[t._v("初始化：插件主类由插件加载器识别并创建实例（如有必要）。插件的依赖将完成链接（"),s("strong",[t._v("因此在初始化之后才允许调用依赖")]),t._v("）；")]),t._v(" "),s("li",[t._v("加载：插件加载器已经识别了所有的插件并根据依赖关系确定了加载顺序。这时插件的 "),s("code",[t._v("onLoad()")]),t._v(" 回调将会被调用，插件做一次性初始化工作；")]),t._v(" "),s("li",[t._v("启用：插件加载器已经加载了所有的插件并调用它们的 "),s("code",[t._v("onLoad()")]),t._v("。这时插件的 "),s("code",[t._v("onEnable()")]),t._v("\n回调将会被调用，插件开始正常工作；")]),t._v(" "),s("li",[t._v("禁用：当用户要求关闭某个插件，或者 Console 正在关闭时插件会被禁用，"),s("code",[t._v("onEnable()")]),t._v("\n回调将会被调用，插件停止一切在启用状态时创建的工作。")])]),t._v(" "),s("p",[t._v("每个插件一定会经历初始化和加载，但可能会经历零次到任意次启用和禁用。根据不同 Console\n前端的行为和用户的设置，插件可能只会加载不会启用，也有可能会在禁用后被重新启用。因此插件必须只在 "),s("code",[t._v("onEnable")]),t._v("\n时创建事件监听等任务，且在禁用时停止这些任务。")]),t._v(" "),s("p",[t._v("多个插件的加载是"),s("em",[t._v("顺序的")]),t._v("，意味着若一个插件的 "),s("code",[t._v("onLoad")]),t._v("\n等回调处理缓慢，后续插件的加载也会被延后，即使它们可能没有依赖关系。因此需要让 "),s("code",[t._v("onLoad")]),t._v("，"),s("code",[t._v("onEnable")]),t._v("，"),s("code",[t._v("onDisable")]),t._v("\n快速返回。")]),t._v(" "),s("h3",{attrs:{id:"有依赖时的加载顺序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#有依赖时的加载顺序"}},[t._v("#")]),t._v(" 有依赖时的加载顺序")]),t._v(" "),s("p",[t._v("若插件 A 需要调用另一个插件 B，那么就认为 A 依赖\nB。当存在依赖关系时，被依赖的插件（B）将总是会早于（A）加载。这适用于所有上述回调，即 B 的 "),s("code",[t._v("onLoad")]),t._v("、"),s("code",[t._v("onEnable")]),t._v(" 会早于\nA 调用，而 "),s("code",[t._v("onDisable")]),t._v(" 会晚于 A 调用。")]),t._v(" "),s("h3",{attrs:{id:"不支持热加载和热卸载"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#不支持热加载和热卸载"}},[t._v("#")]),t._v(" 不支持热加载和热卸载")]),t._v(" "),s("p",[t._v("Mirai Console 不提供热加载和热卸载功能，所有插件只能在服务器启动前加载，在 Console\n停止时卸载。（"),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/QA.md#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E6%94%AF%E6%8C%81%E7%83%AD%E5%8A%A0%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%8F%92%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么不支持热加载和卸载插件？"),s("OutboundLink")],1),t._v("）")]),t._v(" "),s("p",[t._v("只有当插件 A 在其描述中定义了依赖时，才会被允许调用 B 的接口。要了解如何定义，可参考上文 [有关插件依赖的说明]。")]),t._v(" "),s("h3",{attrs:{id:"kotlin-协程生命周期管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kotlin-协程生命周期管理"}},[t._v("#")]),t._v(" Kotlin 协程生命周期管理")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPlugin")]),s("OutboundLink")],1),t._v(" 实现 "),s("code",[t._v("CoroutineScope")]),t._v("，并由 Console 内部实现提供其 "),s("code",[t._v("coroutineContext")]),t._v("。")]),t._v(" "),s("p",[s("strong",[t._v("所有插件启动的协程都应该受 "),s("code",[t._v("JvmPlugin")]),t._v(" 作用域的管理")]),t._v("，如要启动一个协程，正确的做法是：")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MyPluginMain "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("KotlinPlugin")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ... */")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("override")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onEnable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 即 MyPluginMain.launch，在当前协程作用域创建任务。")]),t._v("\n        launch "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delay")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-literal singleline"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"一秒钟过去了。"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// globalEventChannel 在当前协程作用域创建事件通道，会在 onDisable 自动关闭。")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("globalEventChannel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("subscribeAlways"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MemberLeaveEvent"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string-literal singleline"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"有人离开了群。"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br")])]),s("h3",{attrs:{id:"java-线程生命周期管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-线程生命周期管理"}},[t._v("#")]),t._v(" Java 线程生命周期管理")]),t._v(" "),s("p",[t._v("插件创建的所有线程或异步任务都需要在 "),s("code",[t._v("onDisable()")]),t._v(" 时关闭。")]),t._v(" "),s("p",[t._v("若要执行简单的异步、延迟、重复任务，可使用 "),s("code",[t._v("getScheduler()")]),t._v(" 获取到简单任务调度器。示例：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" INSTANCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onEnable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getScheduler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delayed")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"一秒钟过去了。"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("p",[t._v("详细查看 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JavaPluginScheduler.kt",target:"_blank",rel:"noopener noreferrer"}},[t._v("JavaPluginScheduler"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"访问数据目录和配置目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问数据目录和配置目录"}},[t._v("#")]),t._v(" 访问数据目录和配置目录")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPlugin")]),s("OutboundLink")],1),t._v(" 实现接口 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/PluginFileExtensions.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginFileExtensions")]),s("OutboundLink")],1),t._v("。插件可通过 "),s("code",[t._v("resolveDataFile")]),t._v("\n，"),s("code",[t._v("resolveConfigFile")]),t._v(" 等方法取得数据目录或配置目录下的文件。")]),t._v(" "),s("ul",[s("li",[t._v("数据目录（dataFolder）用来存放只供插件内部读取的数据；")]),t._v(" "),s("li",[t._v("配置目录（configFolder）用来存放可由用户修改的配置。")])]),t._v(" "),s("p",[t._v("可以在任何时刻使用这些方法。")]),t._v(" "),s("p",[t._v("详见 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/PluginFileExtensions.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginFileExtensions")]),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[s("em",[t._v("Java")]),t._v(" （Kotlin 类似）")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JavaPlugin")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),t._v(" INSTANCE "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("JExample")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onEnable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("File")]),t._v(" dataFile "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveDataFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myDataFile.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("File")]),t._v(" configFile "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolveConfigFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"myConfigFile.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br")])]),s("h3",{attrs:{id:"物理目录路径"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#物理目录路径"}},[t._v("#")]),t._v(" 物理目录路径")]),t._v(" "),s("p",[t._v("用 "),s("code",[t._v("$root")]),t._v(" 表示 Mirai Console 运行路径，"),s("code",[t._v("$name")]),t._v(" 表示插件名，\n在终端前端（Terminal），插件数据目录一般在 "),s("code",[t._v("$root/data/$name")]),t._v("\n，插件配置目录一般在 "),s("code",[t._v("$root/config/$name")]),t._v("。"),s("strong",[t._v("但是插件不应该依赖这些物理路径，因为在其他前端上没有保证。")])]),t._v(" "),s("h3",{attrs:{id:"访问-jar-包内资源文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#访问-jar-包内资源文件"}},[t._v("#")]),t._v(" 访问 "),s("a",{attrs:{href:"https://zh.wikipedia.org/zh-cn/JAR_(%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F)",target:"_blank",rel:"noopener noreferrer"}},[t._v("JAR"),s("OutboundLink")],1),t._v(" 包内资源文件")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPlugin")]),s("OutboundLink")],1),t._v(" 实现接口 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/ResourceContainer.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("ResourceContainer")]),s("OutboundLink")],1),t._v("。插件可通过 "),s("code",[t._v("getResource")]),t._v("\n，"),s("code",[t._v("getResourceAsStream")]),t._v(" 等取得插件 "),s("a",{attrs:{href:"https://zh.wikipedia.org/zh-cn/JAR_(%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F)",target:"_blank",rel:"noopener noreferrer"}},[t._v("JAR"),s("OutboundLink")],1),t._v(" 包内资源文件。")]),t._v(" "),s("p",[t._v("可以在任何时刻使用这些方法。")]),t._v(" "),s("p",[t._v("详见 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/ResourceContainer.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("ResourceContainer")]),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"构建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[t._v("#")]),t._v(" 构建")]),t._v(" "),s("p",[t._v("构建 mirai-console\n插件推荐使用 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/gradle-plugin/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("mirai-console-gradle"),s("OutboundLink")],1),t._v("\n（若使用推荐方式创建项目则默认使用）。")]),t._v(" "),s("blockquote",[s("p",[t._v("要执行一个名为 "),s("code",[t._v("taskName")]),t._v(" 的 Gradle 任务，可在项目目录使用 "),s("code",[t._v("./gradlew taskName")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"打包和分发插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#打包和分发插件"}},[t._v("#")]),t._v(" 打包和分发插件")]),t._v(" "),s("p",[t._v("执行 Gradle 任务 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/gradle-plugin/README.md#%E6%89%93%E5%8C%85%E4%BE%9D%E8%B5%96",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("buildPlugin")]),s("OutboundLink")],1),t._v("\n即可打包后缀为 "),s("code",[t._v(".mirai2.jar")]),t._v(" 的插件\nJAR。打包结果输出在 "),s("code",[t._v("build/mirai/")]),t._v("。")]),t._v(" "),s("p",[t._v("这个文件就是插件的可分发文件。可以放入 Console "),s("code",[t._v("plugins")]),t._v(" 目录中使用。")]),t._v(" "),s("h4",{attrs:{id:"自-2-11-的变更"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自-2-11-的变更"}},[t._v("#")]),t._v(" 自 2.11 的变更")]),t._v(" "),s("p",[t._v("在 2.11 以前，插件文件后缀为 "),s("code",[t._v(".mirai.jar")]),t._v("，而在 2.11 时插件文件后缀修改为了 "),s("code",[t._v(".mirai2.jar")]),t._v("\n。这是因为依赖打包机制有修改。2.11 起不再打包全部的依赖，而是只打包必要和开发者强制指定的（详见 "),s("a",{attrs:{href:"#%E6%8F%92%E4%BB%B6%E4%BE%9D%E8%B5%96%E6%89%93%E5%8C%85%E6%9C%BA%E5%88%B6"}},[t._v("插件依赖打包机制")]),t._v("\n）。")]),t._v(" "),s("ul",[s("li",[t._v("Console 2.11 及以上在扫描插件时若同时发现 "),s("code",[t._v(".mirai.jar")]),t._v(" 和 "),s("code",[t._v(".mirai2.jar")]),t._v("\n，只会加载 "),s("code",[t._v(".mirai2.jar")]),t._v("。")]),t._v(" "),s("li",[t._v("Console 2.11 以前则会都加载。")])]),t._v(" "),s("p",[t._v("由于 2.10 及以前版本编译的插件也能在 2.11 运行，用户可以顺利地从 2.10 升级到 2.11。但无法直接从 2.11 降级到\n2.10，降级时需要删除 "),s("code",[t._v(".mirai2.jar")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"插件依赖打包机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#插件依赖打包机制"}},[t._v("#")]),t._v(" 插件依赖打包机制")]),t._v(" "),s("p",[t._v("在打包插件时, 所有使用的"),s("em",[t._v("外部依赖")]),s("sup",[t._v("(1)")]),t._v("\n都将会存放于 JAR 内的一个"),s("em",[t._v("依赖列表")]),s("sup",[t._v("(2)")]),t._v("中。")]),t._v(" "),s("p",[t._v("依赖将会在用户侧 Console 启动时从"),s("a",{attrs:{href:"#%E9%BB%98%E8%AE%A4%E7%9A%84%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E5%88%97%E8%A1%A8"}},[t._v("远程仓库")]),t._v("下载并加载。")]),t._v(" "),s("p",[t._v("特别地，直接依赖的本地 JAR 和子项目依赖将会直接打包进插件 JAR。")]),t._v(" "),s("blockquote",[s("p",[t._v("注释")]),t._v(" "),s("ul",[s("li",[t._v("(1): 外部依赖, 即来自 Maven Central 的依赖, 如 "),s("code",[t._v("net.mamoe:mirai-core-api")])]),t._v(" "),s("li",[t._v("(2): 具体文件路径 "),s("code",[t._v("META-INF/mirai-console-plugin/dependencies-private.txt")])]),t._v(" "),s("li",[t._v("(3): 包括直接依赖的本地 JAR (如 "),s("code",[t._v("fileTree('libs')")]),t._v("),\n子项目 ("),s("code",[t._v("project(':subproject')")]),t._v(")"),s("br"),t._v("\n和其他显式声明直接打包的依赖,\n更多见 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/gradle-plugin/README.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("mirai-console-gradle"),s("OutboundLink")],1)])])]),t._v(" "),s("h4",{attrs:{id:"默认的远程仓库列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#默认的远程仓库列表"}},[t._v("#")]),t._v(" 默认的远程仓库列表")]),t._v(" "),s("ul",[s("li",[t._v("Maven\nCentral："),s("a",{attrs:{href:"https://repo.maven.apache.org/maven2/",target:"_blank",rel:"noopener noreferrer"}},[t._v("repo.maven.apache.org"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("阿里云 Maven Central\n中国代理："),s("a",{attrs:{href:"https://maven.aliyun.com/repository/central",target:"_blank",rel:"noopener noreferrer"}},[t._v("maven.aliyun.com"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("默认优先使用阿里云代理仓库，在失败时使用 Maven Central。注意，使用阿里云仓库是不受保证的 – 将来可能会换用其他仓库，但\nMaven\nCentral 官方仓库不会删除（除非用户在配置中删除，当然这不属于开发插件时的考虑范畴）。")]),t._v(" "),s("p",[t._v("用户也可以在配置中自行定义代理仓库，但插件开发者不应该期望于用户自行添加包含插件使用的依赖的仓库。"),s("strong",[t._v("所以插件只应该使用在 Maven\nCentral\n的依赖，且将使用的其他所有依赖"),s("a",{attrs:{href:"#%E8%B0%83%E6%95%B4%E4%BE%9D%E8%B5%96%E6%89%93%E5%8C%85%E7%AD%96%E7%95%A5"}},[t._v("打包")]),t._v("到插件 JAR。")])]),t._v(" "),s("h3",{attrs:{id:"类加载隔离"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#类加载隔离"}},[t._v("#")]),t._v(" 类加载隔离")]),t._v(" "),s("p",[t._v("插件仅能访问自身项目、依赖的库、Console、以及在描述中定义了的依赖的插件。每个插件依赖的库都会被隔离，不同插件可以使用不同版本的同一个库，互不冲突。**\n但不应该在依赖另一个插件时使用不同版本的依赖，这可能导致不确定的后果。**")]),t._v(" "),s("h4",{attrs:{id:"优先加载插件自身及依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优先加载插件自身及依赖"}},[t._v("#")]),t._v(" 优先加载插件自身及依赖")]),t._v(" "),s("p",[t._v("在有潜在类冲突时，将优先选择插件内部实现以及定义的依赖。每个类的搜索顺序是：")]),t._v(" "),s("ul",[s("li",[t._v("插件自身以及"),s("a",{attrs:{href:"#%E8%B0%83%E6%95%B4%E4%BE%9D%E8%B5%96%E6%89%93%E5%8C%85%E7%AD%96%E7%95%A5"}},[t._v("强制打包")]),t._v("的依赖")]),t._v(" "),s("li",[t._v("插件定义的仓库依赖")]),t._v(" "),s("li",[t._v("插件定义的其他插件依赖及它们的依赖（间接）")]),t._v(" "),s("li",[t._v("mirai-console 及 mirai-core 使用的公开依赖，包含：\n"),s("ul",[s("li",[t._v("kotlin-reflect")]),t._v(" "),s("li",[t._v("kotlinx-coroutines-jdk8")]),t._v(" "),s("li",[t._v("kotlinx-serialization-json")]),t._v(" "),s("li",[t._v("ktor-client-okhttp")])]),t._v(" "),s("blockquote",[s("p",[t._v("这些依赖的版本可在 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/buildSrc/src/main/kotlin/Versions.kt",target:"_blank",rel:"noopener noreferrer"}},[t._v("buildSrc"),s("OutboundLink")],1),t._v("\n查看")])])])]),t._v(" "),s("h3",{attrs:{id:"调整依赖打包策略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调整依赖打包策略"}},[t._v("#")]),t._v(" 调整依赖打包策略")]),t._v(" "),s("p",[t._v("要强制打包或忽略某个依赖，请参阅 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/gradle-plugin/README.md#%E6%89%93%E5%8C%85%E4%BE%9D%E8%B5%96",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gradle 插件文档"),s("OutboundLink")],1),t._v("\n。"),s("br"),t._v("\n要了解什么情况下需要强制打包，请参阅 "),s("a",{attrs:{href:"#%E6%8F%92%E4%BB%B6%E4%BE%9D%E8%B5%96%E6%89%93%E5%8C%85%E6%9C%BA%E5%88%B6"}},[t._v("插件依赖打包机制")]),t._v("。")]),t._v(" "),s("h3",{attrs:{id:"发布插件到-mirai-console-loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#发布插件到-mirai-console-loader"}},[t._v("#")]),t._v(" 发布插件到 mirai-console-loader")]),t._v(" "),s("p",[t._v("插件中心仍在开发中。")]),t._v(" "),s("blockquote",[s("p",[t._v("下一步，"),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/Commands.md#mirai-console-backend---commands",target:"_blank",rel:"noopener noreferrer"}},[t._v("Commands"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("返回 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/README.md#mirai-console",target:"_blank",rel:"noopener noreferrer"}},[t._v("开发文档索引"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=e.exports}}]);