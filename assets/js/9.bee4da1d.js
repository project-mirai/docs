(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{750:function(t,a,e){"use strict";e.r(a);var s=e(109),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"mirai-bots"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mirai-bots"}},[t._v("#")]),t._v(" Mirai - Bots")]),t._v(" "),e("p",[e("strong",[t._v("目录")])]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#1-%E5%88%9B%E5%BB%BA%E5%92%8C%E9%85%8D%E7%BD%AE-bot"}},[t._v("1. 创建和配置 "),e("code",[t._v("Bot")])]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE-bot"}},[t._v("配置 Bot")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE"}},[t._v("重要配置")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E5%88%87%E6%8D%A2%E5%BF%83%E8%B7%B3%E7%AD%96%E7%95%A5"}},[t._v("切换心跳策略")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E5%88%87%E6%8D%A2%E7%99%BB%E5%BD%95%E5%8D%8F%E8%AE%AE"}},[t._v("切换登录协议")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E8%A6%86%E7%9B%96%E7%99%BB%E5%BD%95%E8%A7%A3%E5%86%B3%E5%99%A8"}},[t._v("覆盖登录解决器")])])])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E5%B8%B8%E7%94%A8%E9%85%8D%E7%BD%AE"}},[t._v("常用配置")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E4%BF%AE%E6%94%B9%E8%BF%90%E8%A1%8C%E7%9B%AE%E5%BD%95"}},[t._v("修改运行目录")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BF%AE%E6%94%B9-bot-%E7%BC%93%E5%AD%98%E7%9B%AE%E5%BD%95"}},[t._v("修改 Bot 缓存目录")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E8%AE%BE%E5%A4%87%E4%BF%A1%E6%81%AF"}},[t._v("设备信息")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E5%BA%93%E6%8E%A5%E7%AE%A1-mirai-%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F"}},[t._v("使用其他日志库接管 mirai 日志系统")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E9%87%8D%E5%AE%9A%E5%90%91%E6%97%A5%E5%BF%97"}},[t._v("重定向日志")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E5%90%AF%E7%94%A8%E5%88%97%E8%A1%A8%E7%BC%93%E5%AD%98"}},[t._v("启用列表缓存")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E6%9B%B4%E5%A4%9A%E9%85%8D%E7%BD%AE"}},[t._v("更多配置")])])])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%89%80%E6%9C%89-bot-%E5%AE%9E%E4%BE%8B"}},[t._v("获取当前所有 "),e("code",[t._v("Bot")]),t._v(" 实例")])])])]),t._v(" "),e("li",[e("a",{attrs:{href:"#2-%E7%99%BB%E5%BD%95"}},[t._v("2. 登录")]),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"#%E5%A4%84%E7%90%86%E6%BB%91%E5%8A%A8%E9%AA%8C%E8%AF%81%E7%A0%81"}},[t._v("处理滑动验证码")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E5%B8%B8%E8%A7%81%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5%E5%8E%9F%E5%9B%A0"}},[t._v("常见登录失败原因")])])])]),t._v(" "),e("li",[e("a",{attrs:{href:"#%E9%99%84%E5%BD%95-%E8%B0%83%E8%AF%95%E7%BD%91%E7%BB%9C%E5%B1%82"}},[t._v("附录: 调试网络层")])])]),t._v(" "),e("h2",{attrs:{id:"_1-创建和配置-bot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建和配置-bot"}},[t._v("#")]),t._v(" 1. 创建和配置 "),e("code",[t._v("Bot")])]),t._v(" "),e("p",[t._v("一个机器人被以 "),e("code",[t._v("Bot")]),t._v(" 对象描述。mirai 的交互入口点是 "),e("code",[t._v("Bot")]),t._v("。"),e("code",[t._v("Bot")]),t._v(" 只可通过 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/BotFactory.kt#L22-L87",target:"_blank",rel:"noopener noreferrer"}},[e("code",[t._v("BotFactory")]),e("OutboundLink")],1),t._v(" 内的 "),e("code",[t._v("newBot")]),t._v(" 方法获得：")]),t._v(" "),e("div",{staticClass:"language-kotlin line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-kotlin"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" BotFactory "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBot")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("qq"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Long"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configuration"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" BotConfiguration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Bot\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBot")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("qq"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Long"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Bot\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBot")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("qq"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Long"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" passwordMd5"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ByteArray"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configuration"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" BotConfiguration"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Bot\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("newBot")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("qq"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Long"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" passwordMd5"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ByteArray"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Bot\n    \n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("companion")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" BotFactory "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" BotFactoryImpl\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br")])]),e("p",[t._v("通常的调用方法为：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\nval bot = BotFactory.newBot(    )\n\n// Java\nBot bot = BotFactory.INSTANCE.newBot(    );\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("blockquote",[e("p",[t._v("Scala 使用者请查看 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/issues/834",target:"_blank",rel:"noopener noreferrer"}},[t._v("#834"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"配置-bot"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置-bot"}},[t._v("#")]),t._v(" 配置 Bot")]),t._v(" "),e("p",[t._v("可以切换使用的协议、控制日志输出等。")]),t._v(" "),e("p",[t._v("仅能在构造 Bot 时修改其配置：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\nval bot = BotFactory.newBot(qq, password) {\n    // 配置，例如：\n    fileBasedDeviceInfo()\n}\n\n// Java\nBot bot = BotFactory.INSTANCE.newBot(qq, password, new BotConfiguration() {{\n    // 配置，例如：\n    fileBasedDeviceInfo()\n}})\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br")])]),e("p",[t._v("下文示例代码都要放入 "),e("code",[t._v("// 配置")]),t._v(" 中。")]),t._v(" "),e("blockquote",[e("p",[t._v("可在 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/utils/BotConfiguration.kt#L23",target:"_blank",rel:"noopener noreferrer"}},[t._v("BotConfiguration.kt"),e("OutboundLink")],1),t._v(" 查看完整配置列表")])]),t._v(" "),e("h3",{attrs:{id:"重要配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重要配置"}},[t._v("#")]),t._v(" 重要配置")]),t._v(" "),e("h4",{attrs:{id:"切换心跳策略"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#切换心跳策略"}},[t._v("#")]),t._v(" 切换心跳策略")]),t._v(" "),e("p",[t._v("心跳策略默认为最佳的 "),e("code",[t._v("STAT_HB")]),t._v("，但不适用于一些账号。")]),t._v(" "),e("p",[t._v("如果遇到 Bot "),e("strong",[t._v("闲置一段时间后")]),t._v("，发消息返回成功但群内收不到的情况，请切换心跳策略，依次尝试 "),e("code",[t._v("STAT_HB")]),t._v("、"),e("code",[t._v("REGISTER")]),t._v(" 和 "),e("code",[t._v("NONE")]),t._v("。")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\nheartbeatStrategy = BotConfiguration.HeartbeatStrategy.REGISTER\n\n// Java\nsetHeartbeatStrategy(BotConfiguration.HeartbeatStrategy.REGISTER)\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h4",{attrs:{id:"切换登录协议"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#切换登录协议"}},[t._v("#")]),t._v(" 切换登录协议")]),t._v(" "),e("p",[t._v("Mirai 支持多种登录协议："),e("code",[t._v("ANDROID_PHONE")]),t._v("，"),e("code",[t._v("ANDROID_PAD")]),t._v("，"),e("code",[t._v("ANDROID_WATCH")]),t._v("，默认使用 "),e("code",[t._v("ANDROID_PHONE")]),t._v("。")]),t._v(" "),e("p",[t._v("若登录失败，可尝试切换协议。"),e("strong",[t._v("但注意部分功能在部分协议上不受支持")]),t._v("，详见源码内注释。")]),t._v(" "),e("p",[t._v("要切换协议：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\nprotocol = BotConfiguration.MiraiProtocol.ANDROID_PAD\n\n// Java\nsetProtocol(MiraiProtocol.ANDROID_PAD)\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h4",{attrs:{id:"覆盖登录解决器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#覆盖登录解决器"}},[t._v("#")]),t._v(" 覆盖登录解决器")]),t._v(" "),e("p",[t._v("在登录时可能遇到图形验证码或滑动验证码，Mirai 会使用 "),e("code",[t._v("LoginSolver")]),t._v(" 解决验证码。")]),t._v(" "),e("ul",[e("li",[t._v("在 JVM, Mirai 会根据环境支持情况选择 Swing/CLI 实现，通常不需要手动提供")]),t._v(" "),e("li",[t._v("在 Android 需要手动提供 "),e("code",[t._v("LoginSolver")])])]),t._v(" "),e("p",[t._v("若要覆盖默认的 "),e("code",[t._v("LoginSolver")]),t._v(" （通常不需要）：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\nloginSolver = YourLoginSolver\n\n// Java\nsetLoginSolver(new YourLoginSolver())\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("blockquote",[e("p",[t._v("要获取更多有关 "),e("code",[t._v("LoginSolver")]),t._v(" 的信息，查看 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/utils/LoginSolver.kt#L32",target:"_blank",rel:"noopener noreferrer"}},[t._v("LoginSolver.kt"),e("OutboundLink")],1)])]),t._v(" "),e("h3",{attrs:{id:"常用配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用配置"}},[t._v("#")]),t._v(" 常用配置")]),t._v(" "),e("h4",{attrs:{id:"修改运行目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改运行目录"}},[t._v("#")]),t._v(" 修改运行目录")]),t._v(" "),e("p",[t._v("默认为 "),e("code",[t._v('File(".")')])]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('// Kotlin\nworkingDir = File("C:/mirai")\n\n// Java\nsetWorkingDir(new File("C:/mirai"))\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("h4",{attrs:{id:"修改-bot-缓存目录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改-bot-缓存目录"}},[t._v("#")]),t._v(" 修改 Bot 缓存目录")]),t._v(" "),e("p",[t._v("缓存目录会相对于 "),e("code",[t._v("workingDir")]),t._v(" 解析。如 "),e("code",[t._v('File("cache")')]),t._v(" 将会解析为 "),e("code",[t._v("workingDir")]),t._v(" 内的 "),e("code",[t._v("cache")]),t._v(" 目录。而 "),e("code",[t._v('File("C:/cache")')]),t._v(" 将会解析为绝对的 "),e("code",[t._v("C:/cache")]),t._v(" 目录。")]),t._v(" "),e("p",[t._v("默认为 "),e("code",[t._v('File("cache")')])]),t._v(" "),e("p",[t._v("要修改缓存目录（自 mirai 2.4.0）：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('// Kotlin\ncacheDir = File("cache") // 最终为 workingDir 目录中的 cache 目录\ncacheDir = File("C:/cache") // 最终为 C:/cache\n\n// Java\nsetCacheDir(new File("cache")) // 最终为 workingDir 目录中的 cache 目录\nsetCacheDir(new File("C:/cache")) // 最终为 C:/cache\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("p",[t._v("目前缓存目录会存储列表缓存、登录服务器、资源会话秘钥等。这些数据的存储方式有可能变化，请不要修改缓存目录中的文件。")]),t._v(" "),e("p",[t._v("注意，"),e("code",[t._v("cacheDir")]),t._v(" 仅存储与 Bot 相关的上述信息。其他的如 "),e("code",[t._v("InputStream")]),t._v(" 的缓存由 "),e("a",{attrs:{href:"https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/utils/FileCacheStrategy.kt#L55",target:"_blank",rel:"noopener noreferrer"}},[t._v("FileCacheStrategy"),e("OutboundLink")],1),t._v(" 管理，默认使用系统临时文件。")]),t._v(" "),e("h4",{attrs:{id:"设备信息"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设备信息"}},[t._v("#")]),t._v(" 设备信息")]),t._v(" "),e("p",[t._v("Bot 默认使用全随机的设备信息。"),e("strong",[t._v("在更换账号地点时候使用随机设备信息可能会导致无法登录")]),t._v("，当然，"),e("strong",[t._v("成功登录时使用的设备信息也可以保存后在新的设备使用")]),t._v("。")]),t._v(" "),e("p",[t._v("若要在服务器部署，可以先在本地完成登录，再将设备信息上传到服务器。一个设备信息可以一直使用。")]),t._v(" "),e("p",[t._v("要使用 "),e("code",[t._v("device.json")]),t._v(" 存储设备信息：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('fileBasedDeviceInfo() // 存储为 "device.json" \n// 或\nfileBasedDeviceInfo("myDeviceInfo.json") // 存储为 "myDeviceInfo.json"\n')])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("要自定义设备信息：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\ndeviceInfo = { bot ->  /* create device info */   }\n\n// Java\nsetDeviceInfo(bot -> /* create device info */)\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("p",[t._v("在线生成自定义设备信息的 "),e("code",[t._v("device.json")]),t._v(": https://ryoii.github.io/mirai-devicejs-generator/")]),t._v(" "),e("h4",{attrs:{id:"使用其他日志库接管-mirai-日志系统"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用其他日志库接管-mirai-日志系统"}},[t._v("#")]),t._v(" 使用其他日志库接管 mirai 日志系统")]),t._v(" "),e("p",[e("em",[t._v("mirai 2.7 起支持")])]),t._v(" "),e("p",[t._v("使用 Log4J, SLF4J 等接管 mirai 日志系统后则可使用它们的过滤等高级功能。参阅 "),e("RouterLink",{attrs:{to:"/logging/"}},[t._v("mirai-logging")]),t._v(" 以获取更多信息。")],1),t._v(" "),e("h4",{attrs:{id:"重定向日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重定向日志"}},[t._v("#")]),t._v(" 重定向日志")]),t._v(" "),e("p",[t._v("Bot 有两个日志类别，"),e("code",[t._v("Bot")]),t._v(" 或 "),e("code",[t._v("Net")]),t._v("。"),e("code",[t._v("Bot")]),t._v(" 为通常日志，如收到事件。"),e("code",[t._v("Net")]),t._v(" 为网络日志，包含收到和发出的每一个包和网络层解析时遇到的错误。")]),t._v(" "),e("p",[t._v("重定向日志到文件：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("redirectBotLogToFile()\nredirectBotLogToDirectory()\n\nredirectNetworkLogToFile()\nredirectNetworkLogToDirectory()\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("p",[t._v("关闭日志(将会完全禁用日志功能, 无论是否已经通过第三方日志库接管日志系统)：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("noNetworkLog()\nnoBotLog()\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("手动覆盖日志(不建议"),e("RouterLink",{attrs:{to:"/logging/"}},[t._v("(?)")]),t._v(")：")],1),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\nnetworkLoggerSupplier = { bot -> /* create logger */ }\nbotLoggerSupplier = { bot -> /* create logger */ }\n\n// Java\nsetNetworkLoggerSupplier(bot -> /* create logger */)\nsetBotLoggerSupplier(bot -> /* create logger */)\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br")])]),e("h4",{attrs:{id:"启用列表缓存"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启用列表缓存"}},[t._v("#")]),t._v(" 启用列表缓存")]),t._v(" "),e("p",[t._v("Mirai 在启动时会拉取全部好友列表和群成员列表。当账号拥有过多群时登录可能缓慢，开启列表缓存会大幅加速登录过程。")]),t._v(" "),e("p",[t._v("Mirai 自动根据事件更新列表，并在每次登录时与服务器校验缓存有效性，"),e("strong",[t._v("但有时候可能发生意外情况导致列表没有同步。如果出现找不到群员或好友等不同步情况，请关闭缓存并"),e("a",{attrs:{href:"https://github.com/mamoe/mirai/issues/new?assignees=&labels=question&template=bug.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("提交 Bug"),e("OutboundLink")],1)])]),t._v(" "),e("p",[t._v("建议在测试环境使用缓存，而在正式环境关闭缓存（默认关闭缓存）。")]),t._v(" "),e("p",[t._v("要开启列表缓存（自 mirai 2.4.0）：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// 开启所有列表缓存\nenableContactCache()\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br")])]),e("p",[t._v("也可以只开启部分缓存：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("// Kotlin\ncontactListCache {\n    friendListCacheEnabled = true // 开启好友列表缓存\n    groupMemberListCacheEnabled = true // 开启群成员列表缓存\n    \n    saveIntervalMillis = 60_000 // 可选设置有更新时的保存时间间隔, 默认 60 秒\n}\n\n// Java\ncontactListCache.setFriendListCacheEnabled(true) // 开启好友列表缓存\ncontactListCache.setGroupMemberListCacheEnabled(true) // 开启群成员列表缓存\ncontactListCache.setSaveIntervalMillis(60000) // 可选设置有更新时的保存时间间隔, 默认 60 秒\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br")])]),e("h4",{attrs:{id:"更多配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更多配置"}},[t._v("#")]),t._v(" 更多配置")]),t._v(" "),e("p",[t._v("参阅 "),e("code",[t._v("BotConfiguration")]),t._v(" 源码内注释。")]),t._v(" "),e("h3",{attrs:{id:"获取当前所有-bot-实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取当前所有-bot-实例"}},[t._v("#")]),t._v(" 获取当前所有 "),e("code",[t._v("Bot")]),t._v(" 实例")]),t._v(" "),e("p",[t._v("在登录后 "),e("code",[t._v("Bot")]),t._v(" 实例会被自动记录。可在 "),e("code",[t._v("Bot.instances")]),t._v(" 获取到当前"),e("strong",[t._v("在线")]),t._v("的所有 "),e("code",[t._v("Bot")]),t._v(" 列表。")]),t._v(" "),e("h2",{attrs:{id:"_2-登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-登录"}},[t._v("#")]),t._v(" 2. 登录")]),t._v(" "),e("p",[t._v("创建 "),e("code",[t._v("Bot")]),t._v(" 后不会自动登录，需要手动调用其 "),e("code",[t._v("login()")]),t._v(" 方法。只需要调用一次 "),e("code",[t._v("login()")]),t._v(" 即可，"),e("code",[t._v("Bot")]),t._v(" 掉线时会自动重连。")]),t._v(" "),e("h3",{attrs:{id:"处理滑动验证码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#处理滑动验证码"}},[t._v("#")]),t._v(" 处理滑动验证码")]),t._v(" "),e("p",[t._v("服务器正在大力推广滑块验证码。")]),t._v(" "),e("p",[t._v("部分账号可以跳过滑块验证码，Mirai 会自动尝试。"),e("br"),t._v("\n若你的账号无法跳过验证，可在 "),e("a",{attrs:{href:"https://github.com/project-mirai/mirai-login-solver-selenium",target:"_blank",rel:"noopener noreferrer"}},[t._v("project-mirai/mirai-login-solver-selenium"),e("OutboundLink")],1),t._v(" 查看处理方案。")]),t._v(" "),e("h3",{attrs:{id:"常见登录失败原因"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见登录失败原因"}},[t._v("#")]),t._v(" 常见登录失败原因")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"left"}},[t._v("错误信息")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("可能的原因")]),t._v(" "),e("th",{staticStyle:{"text-align":"left"}},[t._v("可能的解决方案")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("当前版本过低")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("密码错误")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("检查密码或修改密码到 16 位以内")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("当前上网环境异常")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("设备锁")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("开启或关闭设备锁 (登录保护)")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("禁止登录")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("需要处理滑块验证码")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[e("a",{attrs:{href:"https://github.com/project-mirai/mirai-login-solver-selenium",target:"_blank",rel:"noopener noreferrer"}},[t._v("project-mirai/mirai-login-solver-selenium"),e("OutboundLink")],1)])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"left"}},[t._v("密码错误")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("密码错误或过长")]),t._v(" "),e("td",{staticStyle:{"text-align":"left"}},[t._v("手机协议最大支持 16 位密码 ("),e("a",{attrs:{href:"https://github.com/mamoe/mirai/discussions/993",target:"_blank",rel:"noopener noreferrer"}},[t._v("#993"),e("OutboundLink")],1),t._v("). 在官方 PC 客户端登录后修改密码")])])])]),t._v(" "),e("p",[t._v("若以上方案无法解决问题，请尝试 "),e("a",{attrs:{href:"#%E5%88%87%E6%8D%A2%E7%99%BB%E5%BD%95%E5%8D%8F%E8%AE%AE"}},[t._v("切换登录协议")]),t._v(" 和 "),e("strong",[e("a",{attrs:{href:"#%E5%A4%84%E7%90%86%E6%BB%91%E5%8A%A8%E9%AA%8C%E8%AF%81%E7%A0%81"}},[t._v("处理滑动验证码")])]),t._v("。")]),t._v(" "),e("blockquote",[e("p",[t._v("下一步，"),e("RouterLink",{attrs:{to:"/Contacts.html"}},[t._v("Contacts")])],1),t._v(" "),e("p",[e("RouterLink",{attrs:{to:"/CoreAPI.html"}},[t._v("回到 Mirai 文档索引")])],1)]),t._v(" "),e("h2",{attrs:{id:"附录-调试网络层"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#附录-调试网络层"}},[t._v("#")]),t._v(" 附录: 调试网络层")]),t._v(" "),e("p",[t._v("参阅 "),e("RouterLink",{attrs:{to:"/DebuggingNetwork.html"}},[t._v("DebuggingNetwork.md")])],1),t._v(" "),e("blockquote",[e("p",[t._v("下一步，"),e("RouterLink",{attrs:{to:"/Contacts.html"}},[t._v("Contacts")])],1),t._v(" "),e("p",[e("RouterLink",{attrs:{to:"/CoreAPI.html"}},[t._v("回到 Mirai 文档索引")])],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);