(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{771:function(a,t,n){"use strict";n.r(t);var s=n(109),e=Object(s.a)({},(function(){var a=this,t=a.$createElement,n=a._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[n("h1",{attrs:{id:"mirai-console-backend-plugins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mirai-console-backend-plugins"}},[a._v("#")]),a._v(" Mirai Console Backend - Plugins")]),a._v(" "),n("p",[a._v("Mirai Console 运行在 "),n("a",{attrs:{href:"https://zh.wikipedia.org/zh-cn/Java%E8%99%9A%E6%8B%9F%E6%9C%BA",target:"_blank",rel:"noopener noreferrer"}},[a._v("JVM"),n("OutboundLink")],1),a._v("，支持使用 "),n("a",{attrs:{href:"https://www.kotlincn.net/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Kotlin"),n("OutboundLink")],1),a._v(" 或 "),n("a",{attrs:{href:"https://www.java.com/zh_CN/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java"),n("OutboundLink")],1),a._v(" 语言编写的插件。")]),a._v(" "),n("h2",{attrs:{id:"通用的插件接口-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通用的插件接口-plugin"}},[a._v("#")]),a._v(" 通用的插件接口 - "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/Plugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("Plugin")]),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("所有 Console 插件都必须实现 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/Plugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("Plugin")]),n("OutboundLink")],1),a._v(" 接口。")]),a._v(" "),n("blockquote",[n("p",[n("strong",[a._v("解释 "),n("em",[a._v("插件")])]),a._v("：只要实现了 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/Plugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("Plugin")]),n("OutboundLink")],1),a._v(" 接口的类和对象都可以叫做「Mirai Console 插件」，简称 「插件」。"),n("br"),a._v("\n为了便捷，内含 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/Plugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("Plugin")]),n("OutboundLink")],1),a._v(" 实现的一个 "),n("a",{attrs:{href:"https://zh.wikipedia.org/zh-cn/JAR_(%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F)",target:"_blank",rel:"noopener noreferrer"}},[a._v("JAR"),n("OutboundLink")],1),a._v(" 文件也可以被称为「插件」。")])]),a._v(" "),n("p",[a._v("基础的 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/Plugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("Plugin")]),n("OutboundLink")],1),a._v(" 很通用，它只拥有很少的成员：")]),a._v(" "),n("div",{staticClass:"language-kotlin line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-kotlin"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("interface")]),a._v(" Plugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" CommandOwner "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// CommandOwner 是空的 interface")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" isEnabled"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Boolean\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" loader"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" PluginLoader"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 能处理这个 Plugin 的 PluginLoader")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br")])]),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/Plugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("Plugin")]),n("OutboundLink")],1),a._v(" 接口拥有强扩展性，以支持 Mirai Console 统一管理使用其他编程语言编写的插件 （详见进阶章节 "),n("RouterLink",{attrs:{to:"/console/Extensions.html"}},[a._v("扩展 - PluginLoader")]),a._v("）。")],1),a._v(" "),n("h2",{attrs:{id:"插件加载器-pluginloader"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件加载器-pluginloader"}},[a._v("#")]),a._v(" 插件加载器 - "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/loader/PluginLoader.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("PluginLoader")]),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("Mirai Console 使用不同的插件加载器来加载不同类型插件。")]),a._v(" "),n("p",[a._v("Mirai Console 内置 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPluginLoader.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPluginLoader")]),n("OutboundLink")],1),a._v(" 以加载 JVM 平台插件（见下文），并允许这些插件注册扩展的插件加载器（见章节 "),n("RouterLink",{attrs:{to:"/console/Extensions.html"}},[a._v("扩展")]),a._v(")")],1),a._v(" "),n("h2",{attrs:{id:"jvm-平台插件接口-jvmplugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jvm-平台插件接口-jvmplugin"}},[a._v("#")]),a._v(" JVM 平台插件接口 - "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPlugin")]),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("所有的 JVM 插件（特别地，"),n("code",[a._v("jar")]),a._v(" 插件）都必须实现 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPlugin")]),n("OutboundLink")],1),a._v("（否则不会被 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPluginLoader.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPluginLoader")]),n("OutboundLink")],1),a._v(" 加载）。"),n("br"),a._v("\nMirai Console 提供一些基础的实现，即 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/AbstractJvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("AbstractJvmPlugin")]),n("OutboundLink")],1),a._v("，并将 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPlugin")]),n("OutboundLink")],1),a._v(" 分为 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/KotlinPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("KotlinPlugin")]),n("OutboundLink")],1),a._v(" 和 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JavaPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JavaPlugin")]),n("OutboundLink")],1),a._v("。")]),a._v(" "),n("h3",{attrs:{id:"主类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主类"}},[a._v("#")]),a._v(" 主类")]),a._v(" "),n("p",[a._v("JVM 平台插件的主类应被实现为一个单例（Kotlin "),n("code",[a._v("object")]),a._v("，Java 静态初始化的类，详见下文示例）。")]),a._v(" "),n("p",[n("strong",[a._v("Kotlin 使用者的插件主类应继承 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/KotlinPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("KotlinPlugin")]),n("OutboundLink")],1),a._v("。")]),n("br"),a._v(" "),n("strong",[a._v("其他 JVM 语言（如 Java）使用者的插件主类应继承 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JavaPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JavaPlugin")]),n("OutboundLink")],1),a._v("。")])]),a._v(" "),n("h4",{attrs:{id:"定义主类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#定义主类"}},[a._v("#")]),a._v(" 定义主类")]),a._v(" "),n("p",[a._v("Mirai Console 使用类似 Java "),n("code",[a._v("ServiceLoader")]),a._v(" 但更灵活的机制加载插件。")]),a._v(" "),n("p",[a._v("一个正确的主类定义可以是以下三种任一：")]),a._v(" "),n("ol",[n("li",[a._v("Kotlin ("),n("code",[a._v("public")]),a._v(") "),n("code",[a._v("object")])])]),a._v(" "),n("div",{staticClass:"language-kotlin line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-kotlin"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("object")]),a._v(" A "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("KotlinPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* 描述 */")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[a._v("Java ("),n("code",[a._v("public")]),a._v(") 静态初始化单例 "),n("code",[a._v("class")])])]),a._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaPlugin")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" INSTANCE "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 必须 public static, 必须名为 INSTANCE")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* 描述 */")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br")])]),n("ol",{attrs:{start:"3"}},[n("li",[a._v("Java ("),n("code",[a._v("public")]),a._v(") "),n("code",[a._v("class")]),n("br"),a._v("\n注意：这种由 Mirai Console 构造插件实例的方法是不推荐的。请首选上述静态初始化方法。")])]),a._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaPlugin")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("A")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 必须公开且无参")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* 描述 */")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("h4",{attrs:{id:"确认主类正确定义"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#确认主类正确定义"}},[a._v("#")]),a._v(" 确认主类正确定义")]),a._v(" "),n("p",[a._v("在 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/intellij-plugin/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Mirai Console IntelliJ 插件"),n("OutboundLink")],1),a._v(" 的帮助下，一个正确的插件主类定义的行号处会显示 Mirai 像素风格形象图："),n("img",{attrs:{src:"https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/intellij-plugin/resources/icons/pluginMainDeclaration.png",alt:"MiraiPixel"}})]),a._v(" "),n("p",[n("img",{attrs:{src:"images/PluginMainDeclaration.png",alt:"PluginMainDeclaration"}})]),a._v(" "),n("h4",{attrs:{id:"配置主类服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置主类服务"}},[a._v("#")]),a._v(" 配置主类服务")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/tools/intellij-plugin/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Mirai Console IntelliJ 插件"),n("OutboundLink")],1),a._v(" 会自动检查主类服务的配置。在没有正确配置时，IDE 将会警告并为你自动配置："),n("br"),a._v(" "),n("img",{attrs:{src:"images/PluginMainServiceNotConfigured.png",alt:"PluginMainServiceNotConfigured"}})]),a._v(" "),n("h5",{attrs:{id:"手动配置主类服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#手动配置主类服务"}},[a._v("#")]),a._v(" 手动配置主类服务")]),a._v(" "),n("p",[a._v("若无法使用 IntelliJ 插件，可在资源目录 "),n("code",[a._v("META-INF/services/net.mamoe.mirai.console.plugin.jvm.JvmPlugin")]),a._v(" 文件内存放插件主类全名（以纯文本 UTF-8 存储，文件内容只包含一行插件主类全名）。")]),a._v(" "),n("p",[a._v("在 Kotlin，也可（"),n("RouterLink",{attrs:{to:"/console/QA.html#使用-autoservice"}},[a._v("使用 AutoService")]),a._v("）自动配置 service 信息。")],1),a._v(" "),n("h3",{attrs:{id:"描述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#描述"}},[a._v("#")]),a._v(" 描述")]),a._v(" "),n("p",[a._v("插件描述需要在主类构造器传递给 "),n("code",[a._v("super")]),a._v("。可以选择直接提供或从 JAR 资源文件读取。")]),a._v(" "),n("p",[a._v("有关插件版本号的限制：")]),a._v(" "),n("ul",[n("li",[a._v("插件自身的版本要求遵循 "),n("a",{attrs:{href:"https://semver.org/lang/zh-CN/",target:"_blank",rel:"noopener noreferrer"}},[a._v("语义化版本 2.0.0"),n("OutboundLink")],1),a._v(" 规范, 合格的版本例如: "),n("code",[a._v("1.0.0")]),a._v(", "),n("code",[a._v("1.0")]),a._v(", "),n("code",[a._v("1.0-M1")]),a._v(", "),n("code",[a._v("1.0-pre-1")])]),a._v(" "),n("li",[a._v("插件依赖的版本遵循 "),n("a",{attrs:{href:"https://semver.org/lang/zh-CN/",target:"_blank",rel:"noopener noreferrer"}},[a._v("语义化版本 2.0.0"),n("OutboundLink")],1),a._v(" 规范, 同时支持 "),n("a",{attrs:{href:"http://ant.apache.org/ivy/history/latest-milestone/settings/version-matchers.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Apache Ivy 风格表示方法"),n("OutboundLink")],1),a._v(".")])]),a._v(" "),n("p",[a._v("有关描述的详细信息可在开发时查看源码内文档。")]),a._v(" "),n("h3",{attrs:{id:"主类的完整示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主类的完整示例"}},[a._v("#")]),a._v(" 主类的完整示例")]),a._v(" "),n("p",[a._v("基于上文，你现在有以下三种主类定义方式。")]),a._v(" "),n("h4",{attrs:{id:"实现-kotlin-插件主类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现-kotlin-插件主类"}},[a._v("#")]),a._v(" 实现 Kotlin 插件主类")]),a._v(" "),n("p",[a._v("一个 Kotlin 插件的主类通常需:")]),a._v(" "),n("ul",[n("li",[a._v("继承 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/KotlinPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("KotlinPlugin")]),n("OutboundLink")],1)]),a._v(" "),n("li",[a._v("访问权限为 "),n("code",[a._v("public")]),a._v(" 或默认 (不指定)")])]),a._v(" "),n("div",{staticClass:"language-kotlin line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-kotlin"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("object")]),a._v(" SchedulePlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("KotlinPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("JvmPluginDescription")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        id "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"org.example.my-schedule-plugin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        version "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.0.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Schedule"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// author("...")')]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// dependsOn("...")')]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ...")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br")])]),n("h4",{attrs:{id:"实现-java-插件主类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现-java-插件主类"}},[a._v("#")]),a._v(" 实现 Java 插件主类")]),a._v(" "),n("p",[a._v("一个 Java 插件的主类通常需:")]),a._v(" "),n("ul",[n("li",[a._v("继承 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JavaPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JavaPlugin")]),n("OutboundLink")],1)]),a._v(" "),n("li",[a._v("访问权限为 "),n("code",[a._v("public")])])]),a._v(" "),n("p",[a._v("(推荐) 静态初始化:")]),a._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaPlugin")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),a._v(" INSTANCE "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 可以像 Kotlin 一样静态初始化单例")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JvmPluginDescriptionBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"org.example.test-plugin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// name")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.0.0"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// version")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// .author("...")')]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// .info("...")')]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br")])]),n("p",[a._v("由 Console 初始化（仅在某些静态初始化不可用的情况下使用）:")]),a._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("extends")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JavaPlugin")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),a._v(" instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("getInstance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" instance"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JExample")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 此时必须 public")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("super")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("JvmPluginDescriptionBuilder")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"org.example.test-plugin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// id")]),a._v("\n            "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.0.0"')]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// version")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// .author("...")')]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// .info("...")')]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        instance "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br")])]),n("h3",{attrs:{id:"依赖管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#依赖管理"}},[a._v("#")]),a._v(" 依赖管理")]),a._v(" "),n("p",[a._v("一个插件被允许依赖于另一个插件。可在 "),n("code",[a._v("SimpleJvmPluginDescription")]),a._v(" 构造时提供信息。")]),a._v(" "),n("p",[a._v("若插件拥有依赖，则会首先加载其依赖。但任何一个插件的 "),n("code",[a._v("onEnable()")]),a._v(" 都会在所有插件的 "),n("code",[a._v("onLoad()")]),a._v(" 都调用成功后再调用。")]),a._v(" "),n("p",[a._v("多个插件的加载是"),n("em",[a._v("顺序的")]),a._v("，意味着若一个插件的 "),n("code",[a._v("onLoad()")]),a._v(" 等回调处理缓慢，后续插件的加载也会被延后，即使它们可能没有依赖关系。"),n("br"),a._v("\n因此请尽量让 "),n("code",[a._v("onLoad()")]),a._v("，"),n("code",[a._v("onEnable()")]),a._v("，"),n("code",[a._v("onDisable()")]),a._v("快速返回。")]),a._v(" "),n("h3",{attrs:{id:"api-导出管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#api-导出管理"}},[a._v("#")]),a._v(" API 导出管理")]),a._v(" "),n("p",[a._v("允许插件将一些内部实现保护起来， 避免其他插件调用， 要启动这个特性，\n只需要创建名为 "),n("code",[a._v("export-rules.txt")]),a._v(" 的规则文件，便可以控制插件的类的公开规则。")]),a._v(" "),n("p",[a._v("如果正在使用 "),n("code",[a._v("Gradle")]),a._v(" 项目, 该规则文件一般位于 "),n("code",[a._v("src/main/resources")]),a._v(" 下")]),a._v(" "),n("p",[a._v("Example:")]),a._v(" "),n("div",{staticClass:"language-text line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[a._v("\n# #开头的行全部识别为注释\n\n# exports, 允许其他插件直接使用某个类\n\n# 导出了一个internal包的一个类\n#\nexports org.example.miraiconsole.myplugin.internal.OpenInternal\n\n# 导出了整个 api 包\n#\nexports org.example.miraiconsole.myplugin.api\n\n# 保护 org.example.miraiconsole.myplugin.api2.Internal, 不允许其他插件直接使用\n#\nprotects org.example.miraiconsole.myplugin.api2.Internal\n\n# 保护整个包\n#\n# 别名: protect-package\nprotects org.example.miraiconsole.myplugin.internal\n\n# 此规则不会生效, 因为在此条规则之前,\n# org.example.miraiconsole.myplugin.internal 已经被加入到保护域中\nexports org.example.miraiconsole.myplugin.internal.NotOpenInternal\n\n\n# export-plugin, 允许其他插件使用除了已经被保护的全部类\n# 使用此规则会同时让此规则后的所有规则全部失效\n# 别名: export-all, export-system\n# export-plugin\n\n\n# 将整个插件放入保护域中\n# 除了此规则之前显式 export 的类, 其他插件将不允许直接使用被保护的插件的任何类\n# 别名: protect-all, protect-system\nprotect-plugin\n\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br"),n("span",{staticClass:"line-number"},[a._v("22")]),n("br"),n("span",{staticClass:"line-number"},[a._v("23")]),n("br"),n("span",{staticClass:"line-number"},[a._v("24")]),n("br"),n("span",{staticClass:"line-number"},[a._v("25")]),n("br"),n("span",{staticClass:"line-number"},[a._v("26")]),n("br"),n("span",{staticClass:"line-number"},[a._v("27")]),n("br"),n("span",{staticClass:"line-number"},[a._v("28")]),n("br"),n("span",{staticClass:"line-number"},[a._v("29")]),n("br"),n("span",{staticClass:"line-number"},[a._v("30")]),n("br"),n("span",{staticClass:"line-number"},[a._v("31")]),n("br"),n("span",{staticClass:"line-number"},[a._v("32")]),n("br"),n("span",{staticClass:"line-number"},[a._v("33")]),n("br"),n("span",{staticClass:"line-number"},[a._v("34")]),n("br"),n("span",{staticClass:"line-number"},[a._v("35")]),n("br"),n("span",{staticClass:"line-number"},[a._v("36")]),n("br"),n("span",{staticClass:"line-number"},[a._v("37")]),n("br"),n("span",{staticClass:"line-number"},[a._v("38")]),n("br")])]),n("p",[a._v("插件也可以通过 Service 来自定义导出控制")]),a._v(" "),n("p",[a._v("Example:")]),a._v(" "),n("div",{staticClass:"language-kotlin line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-kotlin"}},[n("code",[n("span",{pre:!0,attrs:{class:"token annotation builtin"}},[a._v("@AutoService")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("ExportManager"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("object")]),a._v(" MyExportManager"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" ExportManager "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("override")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("isExported")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("className"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Boolean "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("println")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"  <== '),n("span",{pre:!0,attrs:{class:"token interpolation variable"}},[a._v("$className")]),a._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br")])]),n("h3",{attrs:{id:"插件生命周期"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件生命周期"}},[a._v("#")]),a._v(" 插件生命周期")]),a._v(" "),n("p",[a._v("Mirai Console 不提供热加载和热卸载功能，所有插件只能在服务器启动前加载，在服务器结束时卸载。（"),n("RouterLink",{attrs:{to:"/console/QA.html#为什么不支持热加载和卸载插件"}},[a._v("为什么不支持热加载和卸载插件？")]),a._v("）")],1),a._v(" "),n("p",[a._v("插件仅可以通过如下三个回调知晓自身的加载情况。")]),a._v(" "),n("p",[a._v("较小概率情况：")]),a._v(" "),n("ul",[n("li",[a._v("如果 "),n("code",[a._v("onLoad()")]),a._v(" 被调用，"),n("code",[a._v("onEnable()")]),a._v(" 不一定会调用。因为可能在调用后续插件的 "),n("code",[a._v("onLoad()")]),a._v(" 或 "),n("code",[a._v("onEnable()")]),a._v(" 时可能会出错而导致服务器被关闭。")]),a._v(" "),n("li",[a._v("如果 "),n("code",[a._v("onLoad()")]),a._v(" 或 "),n("code",[a._v("onEnable()")]),a._v(" 调用时抛出异常，"),n("code",[a._v("onDisable()")]),a._v(" 不会被调用。（注意：这是仍处于争议状态的行为，后续可能有修改）")]),a._v(" "),n("li",[a._v("如果 "),n("code",[a._v("onEnable()")]),a._v(" 被成功调用，"),n("code",[a._v("onDisable()")]),a._v(" 一定会调用，无论其他插件是否发生错误。")])]),a._v(" "),n("h4",{attrs:{id:"加载"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#加载"}},[a._v("#")]),a._v(" 加载")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPluginLoader.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPluginLoader")]),n("OutboundLink")],1),a._v(" 调用插件的 "),n("code",[a._v("onLoad()")]),a._v("，在 "),n("code",[a._v("onLoad()")]),a._v(" 正常返回后插件被认为成功加载。")]),a._v(" "),n("p",[a._v("由于 "),n("code",[a._v("onLoad()")]),a._v(" 只会被初始化一次，插件可以在该方法内进行一些"),n("em",[a._v("一次性")]),a._v("的"),n("em",[a._v("初始化")]),a._v("任务，如 "),n("RouterLink",{attrs:{to:"/console/Extensions.html#注册扩展"}},[a._v("注册扩展")]),a._v("。")],1),a._v(" "),n("p",[n("strong",[a._v("在 "),n("code",[a._v("onLoad()")]),a._v(" 时插件并未处于启用状态，此时插件不能进行监听事件，加载配置等操作。")])]),a._v(" "),n("p",[a._v("若在 Kotlin 使用 "),n("code",[a._v("object")]),a._v("，或在 Java 使用静态初始化方式定义插件主类, "),n("code",[a._v("onLoad()")]),a._v(" 与 "),n("code",[a._v("init")]),a._v(" 代码块作用几乎相同。")]),a._v(" "),n("h4",{attrs:{id:"启用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启用"}},[a._v("#")]),a._v(" 启用")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPluginLoader.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPluginLoader")]),n("OutboundLink")],1),a._v(" 调用插件的 "),n("code",[a._v("onEnable()")]),a._v("，意为启用一个插件。")]),a._v(" "),n("p",[a._v("此时插件可以启动所有协程，事件监听，和其他任务。"),n("strong",[a._v("但这些任务都应该拥有生命周期管理，详见 "),n("a",{attrs:{href:"#%E4%BB%BB%E5%8A%A1%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E7%AE%A1%E7%90%86"}},[a._v("任务生命周期管理")]),a._v("。")])]),a._v(" "),n("h4",{attrs:{id:"禁用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#禁用"}},[a._v("#")]),a._v(" 禁用")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPluginLoader.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPluginLoader")]),n("OutboundLink")],1),a._v(" 调用插件的 "),n("code",[a._v("onDisable()")]),a._v("，意为禁用一个插件。")]),a._v(" "),n("p",[a._v("插件的任何类和对象都不会被卸载。「禁用」仅表示停止关闭所有正在进行的任务，保存所有数据，停止处理将来的数据。")]),a._v(" "),n("p",[a._v("插件应正确实现「禁用」，以为用户提供完全的控制可能。")]),a._v(" "),n("h3",{attrs:{id:"任务生命周期管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#任务生命周期管理"}},[a._v("#")]),a._v(" 任务生命周期管理")]),a._v(" "),n("h4",{attrs:{id:"协程管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#协程管理"}},[a._v("#")]),a._v(" 协程管理")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPlugin")]),n("OutboundLink")],1),a._v(" 实现 "),n("code",[a._v("CoroutineScope")]),a._v("，并由 Console 内部实现提供其 "),n("code",[a._v("coroutineContext")]),a._v("。")]),a._v(" "),n("p",[n("code",[a._v("JvmPlugin.coroutineContext")]),a._v(" 包含元素 "),n("code",[a._v("CoroutineName")]),a._v(", "),n("code",[a._v("SupervisorJob")]),a._v(", "),n("code",[a._v("CoroutineExceptionHandler")]),a._v("。"),n("br"),a._v(" "),n("strong",[a._v("所有插件启动的协程都应该受 "),n("code",[a._v("JvmPlugin")]),a._v(" 作用域的管理")])]),a._v(" "),n("p",[a._v("如要启动一个协程，正确的做法是：")]),a._v(" "),n("div",{staticClass:"language-kotlin line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-kotlin"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// object MyPluginMain : KotlinPlugin()")]),a._v("\n\nMyPluginMain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("launch")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// job")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br")])]),n("h4",{attrs:{id:"java-线程管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#java-线程管理"}},[a._v("#")]),a._v(" Java 线程管理")]),a._v(" "),n("p",[n("em",[a._v("TODO")]),a._v("：Mirai Console 暂未支持自动的线程管理。请手动在 "),n("code",[a._v("onDisable()")]),a._v(" 时关闭启动的线程。")]),a._v(" "),n("h3",{attrs:{id:"访问数据目录和配置目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问数据目录和配置目录"}},[a._v("#")]),a._v(" 访问数据目录和配置目录")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPlugin")]),n("OutboundLink")],1),a._v(" 实现接口 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/PluginFileExtensions.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("PluginFileExtensions")]),n("OutboundLink")],1),a._v("。插件可通过 "),n("code",[a._v("resolveDataFile")]),a._v("，"),n("code",[a._v("resolveConfigFile")]),a._v(" 等方法取得数据目录或配置目录下的文件。")]),a._v(" "),n("p",[a._v("可以在任何时刻使用这些方法。")]),a._v(" "),n("p",[a._v("详见 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/PluginFileExtensions.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("PluginFileExtensions")]),n("OutboundLink")],1),a._v("。")]),a._v(" "),n("h4",{attrs:{id:"物理目录路径"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#物理目录路径"}},[a._v("#")]),a._v(" 物理目录路径")]),a._v(" "),n("p",[a._v("用 "),n("code",[a._v("$root")]),a._v(" 表示 Mirai Console 运行路径，"),n("code",[a._v("$name")]),a._v(" 表示插件名，\n插件数据目录一般在 "),n("code",[a._v("$root/data/$name")]),a._v("，插件配置目录一般在 "),n("code",[a._v("$root/config/$name")]),a._v("。")]),a._v(" "),n("p",[a._v("有关数据和配置的区别可以在 "),n("RouterLink",{attrs:{to:"/console/PluginData.html"}},[a._v("PluginData")]),a._v(" 章节查看。")],1),a._v(" "),n("h3",{attrs:{id:"访问-jar-包内资源文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#访问-jar-包内资源文件"}},[a._v("#")]),a._v(" 访问 "),n("a",{attrs:{href:"https://zh.wikipedia.org/zh-cn/JAR_(%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F)",target:"_blank",rel:"noopener noreferrer"}},[a._v("JAR"),n("OutboundLink")],1),a._v(" 包内资源文件")]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPlugin")]),n("OutboundLink")],1),a._v(" 实现接口 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/ResourceContainer.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("ResourceContainer")]),n("OutboundLink")],1),a._v("。插件可通过 "),n("code",[a._v("getResource")]),a._v("，"),n("code",[a._v("getResourceAsStream")]),a._v(" 等取得 "),n("a",{attrs:{href:"https://zh.wikipedia.org/zh-cn/JAR_(%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F)",target:"_blank",rel:"noopener noreferrer"}},[a._v("JAR"),n("OutboundLink")],1),a._v(" 包内资源文件。")]),a._v(" "),n("p",[a._v("可以在任何时刻使用这些方法。")]),a._v(" "),n("p",[a._v("详见 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/ResourceContainer.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("ResourceContainer")]),n("OutboundLink")],1),a._v("。")]),a._v(" "),n("h3",{attrs:{id:"读取-plugindata-或-pluginconfig"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#读取-plugindata-或-pluginconfig"}},[a._v("#")]),a._v(" 读取 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("PluginData")]),n("OutboundLink")],1),a._v(" 或 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/data/PluginConfig.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("PluginConfig")]),n("OutboundLink")],1)]),a._v(" "),n("blockquote",[n("p",[a._v("本节基于章节 "),n("RouterLink",{attrs:{to:"/console/PluginData.html"}},[a._v("PluginData")]),a._v(" 的内容。\n在阅读本节前建议先阅读上述基础章节。")],1)]),a._v(" "),n("p",[n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JvmPlugin")]),n("OutboundLink")],1),a._v(" 实现接口 "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/data/PluginDataHolder.kt#L45",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("AutoSavePluginDataHolder")]),n("OutboundLink")],1),a._v("，提供:")]),a._v(" "),n("p",[a._v("Kotlin：")]),a._v(" "),n("ul",[n("li",[n("code",[a._v("public fun <T : PluginData> T.reload()")])]),a._v(" "),n("li",[n("code",[a._v("public fun <T : PluginConfig> T.reload()")])])]),a._v(" "),n("p",[a._v("Java：")]),a._v(" "),n("ul",[n("li",[n("code",[a._v("public fun reloadPluginData(PluginData)")])]),a._v(" "),n("li",[n("code",[a._v("public fun reloadPluginData(PluginConfig)")])])]),a._v(" "),n("p",[n("strong",[a._v("仅可在插件 onEnable() 时及其之后才能使用这些方法。")]),n("br"),a._v(" "),n("strong",[a._v("在插件 onDisable() 之后不能使用这些方法。")])]),a._v(" "),n("h4",{attrs:{id:"使用示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用示例"}},[a._v("#")]),a._v(" 使用示例")]),a._v(" "),n("div",{staticClass:"language-kotlin line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-kotlin"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("object")]),a._v(" SchedulePlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("KotlinPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("JvmPluginDescription")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n        id "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"org.example.my-schedule-plugin"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        version "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1.0.0"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Schedule"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n        \n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// author("...")')]),a._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v('// dependsOn("...")')]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ...")]),a._v("\n    \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("override")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("fun")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("onEnable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        MyData"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("reload")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 仅需此行，保证启动时更新数据，在之后自动存储数据。")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("object")]),a._v(" MyData "),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("AutoSavePluginData")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("val")]),a._v(" value"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" Map"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("String"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" String"),n("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("by")]),a._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[a._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[a._v("1")]),n("br"),n("span",{staticClass:"line-number"},[a._v("2")]),n("br"),n("span",{staticClass:"line-number"},[a._v("3")]),n("br"),n("span",{staticClass:"line-number"},[a._v("4")]),n("br"),n("span",{staticClass:"line-number"},[a._v("5")]),n("br"),n("span",{staticClass:"line-number"},[a._v("6")]),n("br"),n("span",{staticClass:"line-number"},[a._v("7")]),n("br"),n("span",{staticClass:"line-number"},[a._v("8")]),n("br"),n("span",{staticClass:"line-number"},[a._v("9")]),n("br"),n("span",{staticClass:"line-number"},[a._v("10")]),n("br"),n("span",{staticClass:"line-number"},[a._v("11")]),n("br"),n("span",{staticClass:"line-number"},[a._v("12")]),n("br"),n("span",{staticClass:"line-number"},[a._v("13")]),n("br"),n("span",{staticClass:"line-number"},[a._v("14")]),n("br"),n("span",{staticClass:"line-number"},[a._v("15")]),n("br"),n("span",{staticClass:"line-number"},[a._v("16")]),n("br"),n("span",{staticClass:"line-number"},[a._v("17")]),n("br"),n("span",{staticClass:"line-number"},[a._v("18")]),n("br"),n("span",{staticClass:"line-number"},[a._v("19")]),n("br"),n("span",{staticClass:"line-number"},[a._v("20")]),n("br"),n("span",{staticClass:"line-number"},[a._v("21")]),n("br")])]),n("h3",{attrs:{id:"打包插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#打包插件"}},[a._v("#")]),a._v(" 打包插件")]),a._v(" "),n("p",[a._v("若 "),n("RouterLink",{attrs:{to:"/console/ConfiguringProjects.html#c使用-gradle-插件配置项目"}},[a._v("使用了 Mirai Console Gradle 插件")]),a._v(", 执行 Gradle 任务 "),n("code",[a._v("buildPlugin")]),a._v(" 即可打包插件 JAR. 之后可以在 "),n("code",[a._v("build/mirai/")]),a._v(" 找到 JAR 文件. 这个文件可以放入 Mirai Console "),n("code",[a._v("plugins")]),a._v(" 目录中加载.")],1),a._v(" "),n("p",[a._v("若没有使用, 请打包插件并附带资源文件和所有依赖到一个单独的 JAR.")]),a._v(" "),n("h3",{attrs:{id:"发布插件到-mirai-console-loader"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#发布插件到-mirai-console-loader"}},[a._v("#")]),a._v(" 发布插件到 mirai-console-loader")]),a._v(" "),n("p",[n("em",[a._v("TODO")])]),a._v(" "),n("h3",{attrs:{id:"附录-java-插件的多线程调度器-javapluginscheduler"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#附录-java-插件的多线程调度器-javapluginscheduler"}},[a._v("#")]),a._v(" 附录：Java 插件的多线程调度器 - "),n("a",{attrs:{href:"https://github.com/mamoe/mirai/tree/dev/mirai-console/backend/mirai-console/src/plugin/jvm/JavaPluginScheduler.kt",target:"_blank",rel:"noopener noreferrer"}},[n("code",[a._v("JavaPluginScheduler")]),n("OutboundLink")],1)]),a._v(" "),n("p",[a._v("拥有生命周期管理的简单 Java 线程池。其中所有的任务都会在插件被关闭时自动停止。")]),a._v(" "),n("blockquote",[n("p",[a._v("下一步，"),n("RouterLink",{attrs:{to:"/console/Commands.html#mirai-console-backend---commands"}},[a._v("Commands")])],1),a._v(" "),n("p",[a._v("返回 "),n("RouterLink",{attrs:{to:"/console/#mirai-console"}},[a._v("开发文档索引")])],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);