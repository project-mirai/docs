(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{761:function(t,a,s){"use strict";s.r(a);var e=s(109),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"mirai-console-backend-plugindata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mirai-console-backend-plugindata"}},[t._v("#")]),t._v(" Mirai Console Backend - PluginData")]),t._v(" "),s("p",[t._v("Mirai Console 提供支持自动保存的，静态类型插件数据模型。")]),t._v(" "),s("h3",{attrs:{id:"设计目标"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设计目标"}},[t._v("#")]),t._v(" 设计目标")]),t._v(" "),s("ul",[s("li",[t._v("源码级静态强类型：避免 "),s("code",[t._v("getString()")]),t._v(", "),s("code",[t._v("getList()")]),t._v("...")]),t._v(" "),s("li",[t._v("全自动加载保存：插件仅需在启动时通过一行代码链接自动保存")]),t._v(" "),s("li",[t._v("与前端同步修改：在 Android 等图形化前端实现中可以在内存动态同步修改")]),t._v(" "),s("li",[t._v("存储扩展性：可使用多种方式存储，无论是文件还是数据库，插件层都使用同一种实现方式")])]),t._v(" "),s("p",[t._v("综上，"),s("strong",[t._v("最小化插件作者在处理数据和配置做的付出")]),t._v("。")]),t._v(" "),s("p",[s("em",[t._v("暂无数据库保存支持，但这已经被提上日程。")])]),t._v(" "),s("h2",{attrs:{id:"value"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#value"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/Value.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Value")]),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" Value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("T"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReadWriteProperty"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Any"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" T"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation builtin"}},[t._v("@get:JvmName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"get"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token annotation builtin"}},[t._v("@set:JvmName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"set"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" T\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("表示一个值代理。在 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 中，除简单数据类型外，值都经过 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/Value.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Value")]),s("OutboundLink")],1),t._v(" 包装。")]),t._v(" "),s("h2",{attrs:{id:"plugindata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plugindata"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("一个插件内部的, 对用户隐藏的数据对象。类似于属性名作为键，对应 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/Value.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("Value")]),s("OutboundLink")],1),t._v(" 作为值的 "),s("code",[t._v("Map")]),t._v("。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 接口拥有一个基础实现类，"),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/AbstractPluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AbstractPluginData")]),s("OutboundLink")],1),t._v("，默认不支持自动保存，仅存储键值关系及其序列化器。")]),t._v(" "),s("p",[t._v("插件可继承 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/AbstractPluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AbstractPluginData")]),s("OutboundLink")],1),t._v("，拥有高自由的实现细节访问权限，并扩展数据结构。"),s("br"),t._v("\n但通常，插件使用 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/AutoSavePluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AutoSavePluginData")]),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/AutoSavePluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AutoSavePluginData")]),s("OutboundLink")],1),t._v(" 监听保存在它之中的值的修改，并在合适的时机在提供的 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginDataHolder.kt#L45",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AutoSavePluginDataHolder")]),s("OutboundLink")],1),t._v(" 协程作用域下启动协程保存数据。")]),t._v(" "),s("h3",{attrs:{id:"使用-plugindata"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-plugindata"}},[t._v("#")]),t._v(" 使用 "),s("code",[t._v("PluginData")])]),t._v(" "),s("p",[t._v("示例在此时比理论更高效。")]),t._v(" "),s("ol",[s("li",[t._v("定义一个单例，继承 "),s("code",[t._v("AutoSavePluginData")])])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MyData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("AutoSavePluginData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("使用委托添加属性。所有类型都可以使用同样的‘语法’。")])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MyData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("AutoSavePluginData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value1 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Int"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 推断为 Int")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value2 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认值为 0， 推断为 Int")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" value3 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支持 var，修改会自动保存")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value4"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Int "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 显式类型和推断类型，你喜欢哪种？")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value5"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支持 List，Set")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value6"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MutableList"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可按需使用 Mutable 类型")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value7"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支持嵌套")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value8"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 支持 Map")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" value9"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// List、Set 或 Map 同样支持 var。但请注意这是非引用赋值（详见下文）。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br")])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("建立自动保存链接\n使用 "),s("code",[t._v("PluginDataStorage.load(PluginDataHolder, PluginData)")]),t._v(" 即可完成自动保存链接，并读取数据。"),s("br"),t._v("\n对于 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[t._v("JVM 插件"),s("OutboundLink")],1),t._v("，可简便地在 "),s("code",[t._v("onEnable()")]),t._v(" 中使用 "),s("code",[t._v("MyData.reload()")]),t._v("（对于上例）。详见 "),s("RouterLink",{attrs:{to:"/console/Plugins.html#读取-plugindata-或-pluginconfig"}},[t._v("读取 "),s("code",[t._v("PluginData")]),t._v(" 或 "),s("code",[t._v("PluginConfig")])])],1)]),t._v(" "),s("h3",{attrs:{id:"定义数据模型-java"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#定义数据模型-java"}},[t._v("#")]),t._v(" 定义数据模型（Java）")]),t._v(" "),s("p",[s("em",[t._v("由于 Java 语法局限，为 Kotlin 而设计的 PluginData 在 Java 使用很复杂。")]),s("br"),t._v(" "),s("em",[t._v("即使 Mirai Console 为 Java 提供适配器，也强烈推荐 Java 用户在项目中混用 Kotlin 代码来完成数据模型定义。")])]),t._v(" "),s("p",[t._v("参考 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/java/JAutoSavePluginData.kt#L69",target:"_blank",rel:"noopener noreferrer"}},[t._v("JAutoSavePluginData"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"非引用赋值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#非引用赋值"}},[t._v("#")]),t._v(" 非引用赋值")]),t._v(" "),s("p",[t._v("由于实现特殊, 赋值时不会写其引用. 即:")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ArrayList"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("String"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nMyPluginData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" list "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 赋值给 PluginData 的委托属性是非引用的")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyPluginData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "[A]"')]),t._v("\nlist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"B"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "[A, B]"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("MyPluginData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("list"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// "[A]"  // !! 由于 `list` 的引用并未赋值给 `MyPluginData.list`.')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br")])]),s("p",[t._v("另一个更容易出错的示例:")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// MyPluginData.nestedMap: MutableMap<Long, List<Long>> by value()")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" newList "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MyPluginData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("map"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOrPut")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("mutableListOf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nnewList"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不会添加到 MyPluginData.nestedMap 中, 因为 `mutableListOf` 创建的 MutableList 被非引用地添加进了 MyPluginData.nestedMap")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])]),s("p",[t._v("要解决这种无法自动初始化空集合的问题，请查看 "),s("a",{attrs:{href:"#%E5%AE%9E%E9%AA%8C%E6%80%A7%E6%89%A9%E5%B1%95%E6%96%B9%E6%B3%95"}},[t._v("实验性扩展方法")]),t._v(" 方法")]),t._v(" "),s("h3",{attrs:{id:"使用自定义可序列化数据类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义可序列化数据类型"}},[t._v("#")]),t._v(" 使用自定义可序列化数据类型")]),t._v(" "),s("p",[t._v("在 Kotlin，支持使用 "),s("a",{attrs:{href:"https://github.com/kotlin/kotlinx.serialization",target:"_blank",rel:"noopener noreferrer"}},[t._v("kotlinx.serialization"),s("OutboundLink")],1),t._v(" 序列化的自定义数据类型。")]),t._v(" "),s("p",[s("strong",[t._v("Console 使用反射构造自定义数据类型示例")]),t._v("。当自定义数据类型拥有公开无参构造器，或者一个构造器的所有参数都可选时，在使用委托 "),s("code",[t._v("by value()")]),t._v(" 时可无需提供默认值。\n否则，需要提供默认值。（见如下示例）")]),t._v(" "),s("p",[t._v("自定义数据类型定义：")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation builtin"}},[t._v("@Serializable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// kotlinx.serialization.Serializable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CustomA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" str"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token annotation builtin"}},[t._v("@Serializable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CustomB")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" str"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 参数可选，CustomB 就可以直接被反射构造。")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("使用时：")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("object")]),t._v(" MyData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("AutoSavePluginData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value1 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CustomA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// CustomA 不可以通过反射直接构造实例，因为必须提供参数 str。因此要在创建 value 时提供默认值。")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value2"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" CustomB "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// CustomB 可以通过反射直接构造实例")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("h3",{attrs:{id:"实验性-扩展方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验性-扩展方法"}},[t._v("#")]),t._v(" （实验性）"),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginDataExtensions.kt",target:"_blank",rel:"noopener noreferrer"}},[t._v("扩展方法"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("由于非引用赋值特性，在 "),s("code",[t._v("PluginData")]),t._v(" 中定义的 "),s("code",[t._v("Map")]),t._v(" 无法使用 "),s("code",[t._v("map.getOrPut(..., ::mutableListOf)")]),t._v(" 等方法。"),s("br"),t._v("\n为此，Console 提供一些 "),s("em",[t._v("映射方法")]),t._v("。")]),t._v(" "),s("p",[t._v("（下文示例省略 "),s("code",[t._v("Value")]),t._v(" 所在的 "),s("code",[t._v("PluginData")]),t._v(" 定义）")]),t._v(" "),s("h4",{attrs:{id:"实验性-map-withemptydefault"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验性-map-withemptydefault"}},[t._v("#")]),t._v(" （实验性）"),s("code",[t._v("Map.withEmptyDefault")])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" InnerE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" InnerV"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" SerializerAwareValue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("InnerE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" InnerV"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("withEmptyDefault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" SerializerAwareValue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Map"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("InnerE"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" InnerV"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("创建一个代理对象, 当 "),s("code",[t._v("Map.get")]),t._v(" 返回 "),s("code",[t._v("null")]),t._v(" 时先放入一个 "),s("code",[t._v("LinkedHashMap")]),t._v(", 再返回这个 "),s("code",[t._v("LinkedHashMap")]),t._v("。")]),t._v(" "),s("p",[t._v("示例：")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value1 "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Long"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Int"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("withEmptyDefault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("使用时")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" v"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Long"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Int"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MyData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("123456")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此时 Map.get 返回非 null。因为若 MyData 中不存在 123456 对应的值，就先放入一个空 List。")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("strong",[t._v("但是，这种方法不支持多层嵌套")]),t._v("：例如 "),s("code",[t._v("Map<Long, Map<Long, List<Int>>>")]),t._v(" 内层的 Map 不会被这样处理。"),s("br"),t._v("\n因此此方法仍处于实验性状态。如果你有任何建议，请在 issues 中发起讨论。")]),t._v(" "),s("h4",{attrs:{id:"实验性-map-withdefault"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验性-map-withdefault"}},[t._v("#")]),t._v(" （实验性）"),s("code",[t._v("Map.withDefault")])]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" V"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" SerializerAwareValue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" V"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("withDefault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("defaultValueComputer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" V"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" SerializerAwareValue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("K"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" V"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("与上述 "),s("code",[t._v("Map.withEmptyDefault")]),t._v(" 类似。只是把默认值从 "),s("code",[t._v("mutableListOf")]),t._v(" 换成了 "),s("code",[t._v("defaultValueComputer()")])]),t._v(" "),s("p",[s("strong",[t._v("但是，方法命名仍有待确认")]),t._v("："),s("code",[t._v("withDefault")]),t._v(" 可能不是最好的命名，因为可能与标准库的 "),s("code",[t._v("map.withDefault")]),t._v(" 产生歧义（他们行为不同）")]),t._v(" "),s("h4",{attrs:{id:"实验性-map-mapkeys"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实验性-map-mapkeys"}},[t._v("#")]),t._v(" （实验性）"),s("code",[t._v("Map.mapKeys")])]),t._v(" "),s("p",[t._v("映射 "),s("code",[t._v("Map")]),t._v(" 的键。")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fun")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("OldK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NewK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" V"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" SerializerAwareValue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("OldK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" V"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapKeys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    oldToNew"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("OldK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" NewK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    newToOld"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NewK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" OldK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" SerializerAwareValue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("NewK"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" V"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("p",[t._v("可进一步简化配置的操作。")]),t._v(" "),s("p",[t._v("示例：")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" value "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("by")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("MutableMap"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Long"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Int"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("withEmptyDefault")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapKeys")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Bot"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Bot"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("getInstance"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("使用时：")]),t._v(" "),s("div",{staticClass:"language-kotlin line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" bot"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Bot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" list"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" List"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Int"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nvalue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("bot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("listOf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("h2",{attrs:{id:"pluginconfig"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pluginconfig"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginConfig.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginConfig")]),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"plugindata-与-pluginconfig-的区别"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plugindata-与-pluginconfig-的区别"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 与 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginConfig.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginConfig")]),s("OutboundLink")],1),t._v(" 的区别")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 表示插件内部的数据，不应该被用户看到。")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginConfig.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginConfig")]),s("OutboundLink")],1),t._v(" 表示插件的配置，用户可以修改这些配置。")])]),t._v(" "),s("h3",{attrs:{id:"使用-pluginconfig"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-pluginconfig"}},[t._v("#")]),t._v(" 使用 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginConfig.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginConfig")]),s("OutboundLink")],1)]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginConfig.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginConfig")]),s("OutboundLink")],1),t._v(" 与 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 用法完全相同。")]),t._v(" "),s("p",[t._v("在上述 "),s("a",{attrs:{href:"#%E4%BD%BF%E7%94%A8-plugindata"}},[t._v("使用 "),s("code",[t._v("PluginData")])]),t._v(" 的示例中，\n将 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/AutoSavePluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AutoSavePluginData")]),s("OutboundLink")],1),t._v(" 换为 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/AutoSavePluginConfig.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("AutoSavePluginConfig")]),s("OutboundLink")],1),t._v(" 即可创建一个配置，而不是数据。")]),t._v(" "),s("p",[t._v("在加载时使用 "),s("code",[t._v("configInstance.reload()")]),t._v(" 或 "),s("code",[t._v("JvmPlugin.reloadPluginConfig(configInstance)")]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"plugindataholder"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plugindataholder"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginDataHolder.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginDataHolder")]),s("OutboundLink")],1)]),t._v(" "),s("p",[s("em",[s("strong",[t._v("注意：这是实验性 API。")])])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 的拥有者。一般用于区分不同插件的不同 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v("，避免命名冲突。")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/plugin/jvm/JvmPlugin.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("JvmPlugin")]),s("OutboundLink")],1),t._v(" 实现 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginDataHolder.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginDataHolder")]),s("OutboundLink")],1),t._v("，使用插件名作为保存时的名称。")]),t._v(" "),s("h2",{attrs:{id:"plugindatastorage"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#plugindatastorage"}},[t._v("#")]),t._v(" "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginDataStorage.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginDataStorage")]),s("OutboundLink")],1)]),t._v(" "),s("p",[s("em",[s("strong",[t._v("注意：这是实验性 API。")])])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 的存储仓库，将 "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginData.kt",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("PluginData")]),s("OutboundLink")],1),t._v(" 从内存序列化到文件或到数据库，或反之。")]),t._v(" "),s("p",[t._v("内置的实现包含："),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginDataStorage.kt#L116",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MultiFilePluginDataStorage")]),s("OutboundLink")],1),t._v(", "),s("a",{attrs:{href:"https://github.com/mamoe/mirai-console/tree/master/backend/mirai-console/src/data/PluginDataStorage.kt#L100",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MemoryPluginDataStorage")]),s("OutboundLink")],1)]),t._v(" "),s("hr"),t._v(" "),s("blockquote",[s("p",[t._v("下一步，"),s("RouterLink",{attrs:{to:"/console/Permissions.html#mirai-console-backend---permissions"}},[t._v("Permissions")])],1),t._v(" "),s("p",[t._v("返回 "),s("RouterLink",{attrs:{to:"/console/#mirai-console"}},[t._v("开发文档索引")])],1)])])}),[],!1,null,null,null);a.default=n.exports}}]);