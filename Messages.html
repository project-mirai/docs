<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.48">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Mirai - Messages | mirai</title><meta name="description" content="Mirai Project">
    <link rel="modulepreload" href="/assets/app.ea07c51d.js"><link rel="modulepreload" href="/assets/Messages.html.aaeee56e.js"><link rel="modulepreload" href="/assets/Messages.html.97e42be7.js"><link rel="prefetch" href="/assets/Bots.html.c9438536.js"><link rel="prefetch" href="/assets/ConciseAPI.html.a7d78756.js"><link rel="prefetch" href="/assets/ConfiguringMultiplatformProjects.html.e636391a.js"><link rel="prefetch" href="/assets/ConfiguringProjects.html.5c8949fa.js"><link rel="prefetch" href="/assets/ConsoleTerminal.html.f3c65212.js"><link rel="prefetch" href="/assets/Contacts.html.2780bb26.js"><link rel="prefetch" href="/assets/CoreAPI.html.8e308f7a.js"><link rel="prefetch" href="/assets/DebuggingNetwork.html.0053a429.js"><link rel="prefetch" href="/assets/EventList.html.40413e00.js"><link rel="prefetch" href="/assets/Events.html.ff67a963.js"><link rel="prefetch" href="/assets/Evolution.html.7ec2ba1c.js"><link rel="prefetch" href="/assets/KotlinAndJava.html.ea914b75.js"><link rel="prefetch" href="/assets/MigrationFrom1x.html.832d13fd.js"><link rel="prefetch" href="/assets/Preparations.html.51671e23.js"><link rel="prefetch" href="/assets/index.html.eae94381.js"><link rel="prefetch" href="/assets/UserManual.html.70063bd3.js"><link rel="prefetch" href="/assets/UsingSnapshots.html.57cabb94.js"><link rel="prefetch" href="/assets/mirai-ecology.html.37829cd0.js"><link rel="prefetch" href="/assets/Appendix.html.29bccdb2.js"><link rel="prefetch" href="/assets/BuiltInCommands.html.50cbfaf5.js"><link rel="prefetch" href="/assets/Commands.html.044a3aa8.js"><link rel="prefetch" href="/assets/ConfiguringProjects.html.2e1b8301.js"><link rel="prefetch" href="/assets/Contributing.html.d60209a9.js"><link rel="prefetch" href="/assets/Extensions.html.32ddc646.js"><link rel="prefetch" href="/assets/FrontEnd.html.c513236d.js"><link rel="prefetch" href="/assets/Logging.html.a6570352.js"><link rel="prefetch" href="/assets/Permissions.html.e321d525.js"><link rel="prefetch" href="/assets/PluginData.html.a0e22eb9.js"><link rel="prefetch" href="/assets/QA.html.6eeef55b.js"><link rel="prefetch" href="/assets/index.html.c596c4e8.js"><link rel="prefetch" href="/assets/Run.html.3b02c91d.js"><link rel="prefetch" href="/assets/Building.html.baf8111f.js"><link rel="prefetch" href="/assets/BuildingCore.html.31fe91e2.js"><link rel="prefetch" href="/assets/ImplementingProtocol.html.8d36dd39.js"><link rel="prefetch" href="/assets/index.html.11ab28ba.js"><link rel="prefetch" href="/assets/VerifyingABI.html.a6ab27d6.js"><link rel="prefetch" href="/assets/Module.html.30cd0774.js"><link rel="prefetch" href="/assets/Plugin.html.b0e169e3.js"><link rel="prefetch" href="/assets/index.html.d7c9f215.js"><link rel="prefetch" href="/assets/index.html.3c570d43.js"><link rel="prefetch" href="/assets/index.html.b0de09ee.js"><link rel="prefetch" href="/assets/Mocking.html.998fe463.js"><link rel="prefetch" href="/assets/Contacts.mermaid.html.a1ebcdf8.js"><link rel="prefetch" href="/assets/Messages.mermaid.html.1ceae85b.js"><link rel="prefetch" href="/assets/JVMPlugin-Appendix.html.30503fd0.js"><link rel="prefetch" href="/assets/JVMPlugin-DataExchange.html.e3bd96d2.js"><link rel="prefetch" href="/assets/JVMPlugin-Debug.html.1373b734.js"><link rel="prefetch" href="/assets/JVMPlugin.html.00b48355.js"><link rel="prefetch" href="/assets/Plugins.html.f9e73a66.js"><link rel="prefetch" href="/assets/Adapter.html.e3609f9a.js"><link rel="prefetch" href="/assets/CustomizedAdapter.html.d79ece6c.js"><link rel="prefetch" href="/assets/HttpAdapter.html.5d1ccc04.js"><link rel="prefetch" href="/assets/ReverseWebsocketAdapter.html.fd95e5ae.js"><link rel="prefetch" href="/assets/WebhookAdapter.html.043a9c43.js"><link rel="prefetch" href="/assets/WebsocketAdapter.html.6a90e3d7.js"><link rel="prefetch" href="/assets/API.html.ea4addf9.js"><link rel="prefetch" href="/assets/EventType.html.9223bbb6.js"><link rel="prefetch" href="/assets/MessageType.html.97ab6b0a.js"><link rel="prefetch" href="/assets/Migration2.html.d51f268d.js"><link rel="prefetch" href="/assets/404.html.7d858b3d.js"><link rel="prefetch" href="/assets/Bots.html.1842a6d3.js"><link rel="prefetch" href="/assets/ConciseAPI.html.0a73aa5a.js"><link rel="prefetch" href="/assets/ConfiguringMultiplatformProjects.html.e34f8b1a.js"><link rel="prefetch" href="/assets/ConfiguringProjects.html.37e4b949.js"><link rel="prefetch" href="/assets/ConsoleTerminal.html.d00382e9.js"><link rel="prefetch" href="/assets/Contacts.html.5134c660.js"><link rel="prefetch" href="/assets/CoreAPI.html.9185a1ff.js"><link rel="prefetch" href="/assets/DebuggingNetwork.html.54698055.js"><link rel="prefetch" href="/assets/EventList.html.5f9d098a.js"><link rel="prefetch" href="/assets/Events.html.4d91574d.js"><link rel="prefetch" href="/assets/Evolution.html.c6abf9fa.js"><link rel="prefetch" href="/assets/KotlinAndJava.html.35b3e65d.js"><link rel="prefetch" href="/assets/MigrationFrom1x.html.2560d9f0.js"><link rel="prefetch" href="/assets/Preparations.html.3dff8924.js"><link rel="prefetch" href="/assets/index.html.702dda46.js"><link rel="prefetch" href="/assets/UserManual.html.40ec0287.js"><link rel="prefetch" href="/assets/UsingSnapshots.html.d33de326.js"><link rel="prefetch" href="/assets/mirai-ecology.html.ea4da7ec.js"><link rel="prefetch" href="/assets/Appendix.html.fedeb029.js"><link rel="prefetch" href="/assets/BuiltInCommands.html.3ef7e766.js"><link rel="prefetch" href="/assets/Commands.html.de5bade5.js"><link rel="prefetch" href="/assets/ConfiguringProjects.html.4a24c5b8.js"><link rel="prefetch" href="/assets/Contributing.html.ff9c1b39.js"><link rel="prefetch" href="/assets/Extensions.html.021d5bbc.js"><link rel="prefetch" href="/assets/FrontEnd.html.7b4a8b5f.js"><link rel="prefetch" href="/assets/Logging.html.5a23b166.js"><link rel="prefetch" href="/assets/Permissions.html.ef05f7ce.js"><link rel="prefetch" href="/assets/PluginData.html.40e2cecd.js"><link rel="prefetch" href="/assets/QA.html.d6661d97.js"><link rel="prefetch" href="/assets/index.html.527cf474.js"><link rel="prefetch" href="/assets/Run.html.0ee73904.js"><link rel="prefetch" href="/assets/Building.html.aa6d7920.js"><link rel="prefetch" href="/assets/BuildingCore.html.f3213ded.js"><link rel="prefetch" href="/assets/ImplementingProtocol.html.4f8fb1a7.js"><link rel="prefetch" href="/assets/index.html.7bed8ee4.js"><link rel="prefetch" href="/assets/VerifyingABI.html.3ff96f48.js"><link rel="prefetch" href="/assets/Module.html.da68d51d.js"><link rel="prefetch" href="/assets/Plugin.html.4c99dd21.js"><link rel="prefetch" href="/assets/index.html.0dacdf47.js"><link rel="prefetch" href="/assets/index.html.4666341c.js"><link rel="prefetch" href="/assets/index.html.2ba4908d.js"><link rel="prefetch" href="/assets/Mocking.html.7a8c5535.js"><link rel="prefetch" href="/assets/Contacts.mermaid.html.97bfae22.js"><link rel="prefetch" href="/assets/Messages.mermaid.html.9fd93fff.js"><link rel="prefetch" href="/assets/JVMPlugin-Appendix.html.af60abb5.js"><link rel="prefetch" href="/assets/JVMPlugin-DataExchange.html.f0d0c66d.js"><link rel="prefetch" href="/assets/JVMPlugin-Debug.html.752206f1.js"><link rel="prefetch" href="/assets/JVMPlugin.html.009008e3.js"><link rel="prefetch" href="/assets/Plugins.html.f350af3a.js"><link rel="prefetch" href="/assets/Adapter.html.05998cee.js"><link rel="prefetch" href="/assets/CustomizedAdapter.html.ddad5589.js"><link rel="prefetch" href="/assets/HttpAdapter.html.b46fa649.js"><link rel="prefetch" href="/assets/ReverseWebsocketAdapter.html.27d81ea3.js"><link rel="prefetch" href="/assets/WebhookAdapter.html.50c39e90.js"><link rel="prefetch" href="/assets/WebsocketAdapter.html.71aada8b.js"><link rel="prefetch" href="/assets/API.html.d518b74e.js"><link rel="prefetch" href="/assets/EventType.html.656333e5.js"><link rel="prefetch" href="/assets/MessageType.html.1c3657d4.js"><link rel="prefetch" href="/assets/Migration2.html.2985f44f.js"><link rel="prefetch" href="/assets/404.html.f838f3b8.js"><link rel="prefetch" href="/assets/404.ff5aa0c9.js"><link rel="prefetch" href="/assets/Layout.fd4137b8.js">
    <link rel="stylesheet" href="/assets/style.24c55b2e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/mirai.png" alt="mirai"><span class="site-name can-hide">mirai</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-core"><span class="title">mirai-core</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-core"><span class="title">mirai-core</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/" class="" aria-label="Index"><!--[--><!--]--> Index <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-ecology.html" class="" aria-label="Mirai 生态概览"><!--[--><!--]--> Mirai 生态概览 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MigrationFrom1x.html" class="" aria-label="从 1.x 迁移"><!--[--><!--]--> 从 1.x 迁移 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/UserManual.html" class="" aria-label="用户手册"><!--[--><!--]--> 用户手册 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ConsoleTerminal.html" class="" aria-label="用户手册 - 控制台"><!--[--><!--]--> 用户手册 - 控制台 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/Preparations.html" class="" aria-label="JVM 环境和开发准备工作"><!--[--><!--]--> JVM 环境和开发准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ConfiguringProjects.html" class="" aria-label="配置项目"><!--[--><!--]--> 配置项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>CoreAPI</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/CoreAPI.html" class="" aria-label="CoreAPI"><!--[--><!--]--> CoreAPI <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Bots.html" class="" aria-label="机器人"><!--[--><!--]--> 机器人 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Contacts.html" class="" aria-label="联系人"><!--[--><!--]--> 联系人 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Events.html" class="" aria-label="事件"><!--[--><!--]--> 事件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/Messages.html" class="router-link-active router-link-exact-active router-link-active" aria-label="消息"><!--[--><!--]--> 消息 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Misc</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ConciseAPI.html" class="" aria-label="主要API"><!--[--><!--]--> 主要API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Evolution.html" class="" aria-label="Mirai - Evolution"><!--[--><!--]--> Mirai - Evolution <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/KotlinAndJava.html" class="" aria-label="Kotlin &amp; Java"><!--[--><!--]--> Kotlin &amp; Java <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/EventList.html" class="" aria-label="事件列表"><!--[--><!--]--> 事件列表 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/DebuggingNetwork.html" class="" aria-label="Debugging Network"><!--[--><!--]--> Debugging Network <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/UsingSnapshots.html" class="" aria-label="Using Dev Snapshots"><!--[--><!--]--> Using Dev Snapshots <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mocking/Mocking.md" class="" aria-label="mirai 模拟测试框架"><!--[--><!--]--> mirai 模拟测试框架 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-console"><span class="title">mirai-console</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-console"><span class="title">mirai-console</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/console/" class="" aria-label="Index"><!--[--><!--]--> Index <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/console/ConfiguringProjects.html" class="" aria-label="配置项目"><!--[--><!--]--> 配置项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/console/Run.html" class="" aria-label="启动 Console"><!--[--><!--]--> 启动 Console <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端插件开发基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/plugin/Plugins.html" class="" aria-label="插件 - Plugin 模块"><!--[--><!--]--> 插件 - Plugin 模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin.html" class="" aria-label="插件 - JVM Plugin"><!--[--><!--]--> 插件 - JVM Plugin <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Commands.html" class="" aria-label="指令 - Command 模块"><!--[--><!--]--> 指令 - Command 模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/PluginData.html" class="" aria-label="存储 - PluginData 模块"><!--[--><!--]--> 存储 - PluginData 模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Permissions.html" class="" aria-label="权限 - Permission 模块"><!--[--><!--]--> 权限 - Permission 模块 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端插件开发进阶</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/Extensions.html" class="" aria-label="扩展 - Extension 模块和扩展点"><!--[--><!--]--> 扩展 - Extension 模块和扩展点 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>实现前端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/FrontEnd.html" class="" aria-label="FrontEnd"><!--[--><!--]--> FrontEnd <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Misc</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/QA.html" class="" aria-label="Q &amp; A"><!--[--><!--]--> Q &amp; A <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Logging.html" class="" aria-label="日志配置"><!--[--><!--]--> 日志配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/BuiltInCommands.html" class="" aria-label="内置命令"><!--[--><!--]--> 内置命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Appendix.html" class="" aria-label="Mirai Console 附录"><!--[--><!--]--> Mirai Console 附录 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin-Appendix.html" class="" aria-label="插件 - JVM Plugin - 附录"><!--[--><!--]--> 插件 - JVM Plugin - 附录 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin-DataExchange.html" class="" aria-label="插件 - JVM Plugin - 多插件数据交换"><!--[--><!--]--> 插件 - JVM Plugin - 多插件数据交换 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin-Debug.html" class="" aria-label="插件 - JVM Plugin - 排错"><!--[--><!--]--> 插件 - JVM Plugin - 排错 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a href="/mirai-login-solver-selenium/" class="" aria-label="mirai-login-solver-selenium"><!--[--><!--]--> mirai-login-solver-selenium <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-api-http"><span class="title">mirai-api-http</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-api-http"><span class="title">mirai-api-http</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/mirai-api-http/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-api-http/api/API.html" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-api-http/api/EventType.html" class="" aria-label="事件类型"><!--[--><!--]--> 事件类型 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-api-http/api/MessageType.html" class="" aria-label="消息类型"><!--[--><!--]--> 消息类型 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>接口适配器</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/HttpAdapter.html" class="" aria-label="http轮询"><!--[--><!--]--> http轮询 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/WebsocketAdapter.html" class="" aria-label="websocket"><!--[--><!--]--> websocket <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/ReverseWebsocketAdapter.html" class="" aria-label="反向websocket"><!--[--><!--]--> 反向websocket <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/WebhookAdapter.html" class="" aria-label="webhook上报"><!--[--><!--]--> webhook上报 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-console-loader"><span class="title">mirai-console-loader</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-console-loader"><span class="title">mirai-console-loader</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/mcl/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mcl/Module.html" class="" aria-label="MCL模块"><!--[--><!--]--> MCL模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mcl/Plugin.html" class="" aria-label="MCL插件"><!--[--><!--]--> MCL插件 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/mamoe/mirai" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-core"><span class="title">mirai-core</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-core"><span class="title">mirai-core</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/" class="" aria-label="Index"><!--[--><!--]--> Index <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-ecology.html" class="" aria-label="Mirai 生态概览"><!--[--><!--]--> Mirai 生态概览 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/MigrationFrom1x.html" class="" aria-label="从 1.x 迁移"><!--[--><!--]--> 从 1.x 迁移 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/UserManual.html" class="" aria-label="用户手册"><!--[--><!--]--> 用户手册 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ConsoleTerminal.html" class="" aria-label="用户手册 - 控制台"><!--[--><!--]--> 用户手册 - 控制台 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/Preparations.html" class="" aria-label="JVM 环境和开发准备工作"><!--[--><!--]--> JVM 环境和开发准备工作 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ConfiguringProjects.html" class="" aria-label="配置项目"><!--[--><!--]--> 配置项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>CoreAPI</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/CoreAPI.html" class="" aria-label="CoreAPI"><!--[--><!--]--> CoreAPI <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Bots.html" class="" aria-label="机器人"><!--[--><!--]--> 机器人 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Contacts.html" class="" aria-label="联系人"><!--[--><!--]--> 联系人 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Events.html" class="" aria-label="事件"><!--[--><!--]--> 事件 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/Messages.html" class="router-link-active router-link-exact-active router-link-active" aria-label="消息"><!--[--><!--]--> 消息 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Misc</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/ConciseAPI.html" class="" aria-label="主要API"><!--[--><!--]--> 主要API <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/Evolution.html" class="" aria-label="Mirai - Evolution"><!--[--><!--]--> Mirai - Evolution <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/KotlinAndJava.html" class="" aria-label="Kotlin &amp; Java"><!--[--><!--]--> Kotlin &amp; Java <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/EventList.html" class="" aria-label="事件列表"><!--[--><!--]--> 事件列表 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/DebuggingNetwork.html" class="" aria-label="Debugging Network"><!--[--><!--]--> Debugging Network <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/UsingSnapshots.html" class="" aria-label="Using Dev Snapshots"><!--[--><!--]--> Using Dev Snapshots <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mocking/Mocking.md" class="" aria-label="mirai 模拟测试框架"><!--[--><!--]--> mirai 模拟测试框架 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-console"><span class="title">mirai-console</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-console"><span class="title">mirai-console</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/console/" class="" aria-label="Index"><!--[--><!--]--> Index <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/console/ConfiguringProjects.html" class="" aria-label="配置项目"><!--[--><!--]--> 配置项目 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/console/Run.html" class="" aria-label="启动 Console"><!--[--><!--]--> 启动 Console <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端插件开发基础</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/plugin/Plugins.html" class="" aria-label="插件 - Plugin 模块"><!--[--><!--]--> 插件 - Plugin 模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin.html" class="" aria-label="插件 - JVM Plugin"><!--[--><!--]--> 插件 - JVM Plugin <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Commands.html" class="" aria-label="指令 - Command 模块"><!--[--><!--]--> 指令 - Command 模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/PluginData.html" class="" aria-label="存储 - PluginData 模块"><!--[--><!--]--> 存储 - PluginData 模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Permissions.html" class="" aria-label="权限 - Permission 模块"><!--[--><!--]--> 权限 - Permission 模块 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>后端插件开发进阶</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/Extensions.html" class="" aria-label="扩展 - Extension 模块和扩展点"><!--[--><!--]--> 扩展 - Extension 模块和扩展点 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>实现前端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/FrontEnd.html" class="" aria-label="FrontEnd"><!--[--><!--]--> FrontEnd <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Misc</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/console/QA.html" class="" aria-label="Q &amp; A"><!--[--><!--]--> Q &amp; A <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Logging.html" class="" aria-label="日志配置"><!--[--><!--]--> 日志配置 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/BuiltInCommands.html" class="" aria-label="内置命令"><!--[--><!--]--> 内置命令 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/Appendix.html" class="" aria-label="Mirai Console 附录"><!--[--><!--]--> Mirai Console 附录 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin-Appendix.html" class="" aria-label="插件 - JVM Plugin - 附录"><!--[--><!--]--> 插件 - JVM Plugin - 附录 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin-DataExchange.html" class="" aria-label="插件 - JVM Plugin - 多插件数据交换"><!--[--><!--]--> 插件 - JVM Plugin - 多插件数据交换 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/console/plugin/JVMPlugin-Debug.html" class="" aria-label="插件 - JVM Plugin - 排错"><!--[--><!--]--> 插件 - JVM Plugin - 排错 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><a href="/mirai-login-solver-selenium/" class="" aria-label="mirai-login-solver-selenium"><!--[--><!--]--> mirai-login-solver-selenium <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-api-http"><span class="title">mirai-api-http</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-api-http"><span class="title">mirai-api-http</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/mirai-api-http/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-api-http/api/API.html" class="" aria-label="API"><!--[--><!--]--> API <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-api-http/api/EventType.html" class="" aria-label="事件类型"><!--[--><!--]--> 事件类型 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mirai-api-http/api/MessageType.html" class="" aria-label="消息类型"><!--[--><!--]--> 消息类型 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>接口适配器</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/HttpAdapter.html" class="" aria-label="http轮询"><!--[--><!--]--> http轮询 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/WebsocketAdapter.html" class="" aria-label="websocket"><!--[--><!--]--> websocket <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/ReverseWebsocketAdapter.html" class="" aria-label="反向websocket"><!--[--><!--]--> 反向websocket <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/mirai-api-http/adapter/WebhookAdapter.html" class="" aria-label="webhook上报"><!--[--><!--]--> webhook上报 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="mirai-console-loader"><span class="title">mirai-console-loader</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="mirai-console-loader"><span class="title">mirai-console-loader</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/mcl/" class="" aria-label="主页"><!--[--><!--]--> 主页 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mcl/Module.html" class="" aria-label="MCL模块"><!--[--><!--]--> MCL模块 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/mcl/Plugin.html" class="" aria-label="MCL插件"><!--[--><!--]--> MCL插件 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/mamoe/mirai" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Mirai - Messages <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Messages.html#目录" class="router-link-active router-link-exact-active sidebar-item" aria-label="目录"><!--[--><!--]--> 目录 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#消息系统" class="router-link-active router-link-exact-active sidebar-item" aria-label="消息系统"><!--[--><!--]--> 消息系统 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#消息类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="消息类型"><!--[--><!--]--> 消息类型 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Messages.html#内容" class="router-link-active router-link-exact-active sidebar-item" aria-label="内容"><!--[--><!--]--> 内容 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#元数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="元数据"><!--[--><!--]--> 元数据 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Messages.html#消息元素" class="router-link-active router-link-exact-active sidebar-item" aria-label="消息元素"><!--[--><!--]--> 消息元素 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Messages.html#用法" class="router-link-active router-link-exact-active sidebar-item" aria-label="用法"><!--[--><!--]--> 用法 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Messages.html#消息链" class="router-link-active router-link-exact-active sidebar-item" aria-label="消息链"><!--[--><!--]--> 消息链 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Messages.html#发送消息" class="router-link-active router-link-exact-active sidebar-item" aria-label="发送消息"><!--[--><!--]--> 发送消息 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#构造消息链" class="router-link-active router-link-exact-active sidebar-item" aria-label="构造消息链"><!--[--><!--]--> 构造消息链 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#作为字符串处理消息" class="router-link-active router-link-exact-active sidebar-item" aria-label="作为字符串处理消息"><!--[--><!--]--> 作为字符串处理消息 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#处理富文本消息" class="router-link-active router-link-exact-active sidebar-item" aria-label="处理富文本消息"><!--[--><!--]--> 处理富文本消息 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#元素唯一性" class="router-link-active router-link-exact-active sidebar-item" aria-label="元素唯一性"><!--[--><!--]--> 元素唯一性 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#获取消息链中的消息元素" class="router-link-active router-link-exact-active sidebar-item" aria-label="获取消息链中的消息元素"><!--[--><!--]--> 获取消息链中的消息元素 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#序列化" class="router-link-active router-link-exact-active sidebar-item" aria-label="序列化"><!--[--><!--]--> 序列化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#消息的其他常用功能" class="router-link-active router-link-exact-active sidebar-item" aria-label="消息的其他常用功能"><!--[--><!--]--> 消息的其他常用功能 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/Messages.html#mirai-码" class="router-link-active router-link-exact-active sidebar-item" aria-label="Mirai 码"><!--[--><!--]--> Mirai 码 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/Messages.html#转义规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="转义规则"><!--[--><!--]--> 转义规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#组成约定" class="router-link-active router-link-exact-active sidebar-item" aria-label="组成约定"><!--[--><!--]--> 组成约定 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#消息链的-mirai-码" class="router-link-active router-link-exact-active sidebar-item" aria-label="消息链的 mirai 码"><!--[--><!--]--> 消息链的 mirai 码 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#由-codablemessage-取得-mirai-码字符串" class="router-link-active router-link-exact-active sidebar-item" aria-label="由 CodableMessage 取得 mirai 码字符串"><!--[--><!--]--> 由 CodableMessage 取得 mirai 码字符串 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#由-mirai-码字符串取得-messagechain-实例" class="router-link-active router-link-exact-active sidebar-item" aria-label="由 mirai 码字符串取得 MessageChain 实例"><!--[--><!--]--> 由 mirai 码字符串取得 MessageChain 实例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#转义字符串" class="router-link-active router-link-exact-active sidebar-item" aria-label="转义字符串"><!--[--><!--]--> 转义字符串 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/Messages.html#serializetomiraicode-与-tostring-的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="serializeToMiraiCode 与 toString 的区别"><!--[--><!--]--> serializeToMiraiCode 与 toString 的区别 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="mirai-messages" tabindex="-1"><a class="header-anchor" href="#mirai-messages" aria-hidden="true">#</a> Mirai - Messages</h1><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录" aria-hidden="true">#</a> 目录</h2><ul><li><a href="#%E6%B6%88%E6%81%AF%E7%B3%BB%E7%BB%9F">消息系统</a></li><li><a href="#%E6%B6%88%E6%81%AF%E7%B1%BB%E5%9E%8B">消息类型</a></li><li><a href="#%E6%B6%88%E6%81%AF%E5%85%83%E7%B4%A0">消息元素</a></li><li><a href="#%E6%B6%88%E6%81%AF%E9%93%BE">消息链</a><ul><li><a href="#%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF">发送消息</a></li><li><a href="#%E6%9E%84%E9%80%A0%E6%B6%88%E6%81%AF%E9%93%BE">构造消息链</a></li><li><a href="#%E5%85%83%E7%B4%A0%E5%94%AF%E4%B8%80%E6%80%A7">元素唯一性</a></li><li><a href="#%E8%8E%B7%E5%8F%96%E6%B6%88%E6%81%AF%E9%93%BE%E4%B8%AD%E7%9A%84%E6%B6%88%E6%81%AF%E5%85%83%E7%B4%A0">获取消息链中的消息元素</a></li><li><a href="#%E5%BA%8F%E5%88%97%E5%8C%96">序列化</a></li><li><a href="#%E6%B6%88%E6%81%AF%E7%9A%84%E5%85%B6%E4%BB%96%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD">消息的其他常用功能</a></li></ul></li><li><a href="#mirai-%E7%A0%81">Mirai 码</a><ul><li><a href="#%E8%BD%AC%E4%B9%89%E8%A7%84%E5%88%99">转义规则</a></li><li><a href="#%E6%B6%88%E6%81%AF%E9%93%BE%E7%9A%84-mirai-%E7%A0%81">消息链的 mirai 码</a></li><li><a href="#%E7%94%B1-codablemessage-%E5%8F%96%E5%BE%97-mirai-%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2">由 <code>CodableMessage</code> 取得 mirai 码字符串</a></li><li><a href="#%E7%94%B1-mirai-%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8F%96%E5%BE%97-messagechain-%E5%AE%9E%E4%BE%8B">由 mirai 码字符串取得 <code>MessageChain</code> 实例</a></li><li><a href="#serializetomiraicode-%E4%B8%8E-tostring-%E7%9A%84%E5%8C%BA%E5%88%AB"><code>serializeToMiraiCode</code> 与 <code>toString</code> 的区别</a></li></ul></li></ul><hr><h2 id="消息系统" tabindex="-1"><a class="header-anchor" href="#消息系统" aria-hidden="true">#</a> 消息系统</h2><p>在<a href="/Contacts.html" class="">Contacts 章节</a>提到，要发送消息，使用 <code>Contact.sendMessage(Message)</code>。<code>Message</code> 架构如下图所示。</p><p><a href="https://mermaid-js.github.io/mermaid-live-editor/#/edit/eyJjb2RlIjoiY2xhc3NEaWFncmFtXG5cbmNsYXNzIE1lc3NhZ2VDaGFpblxuTWVzc2FnZUNoYWluIDogTGlzdH5TaW5nbGVNZXNzYWdlflxuXG5NZXNzYWdlPHwtLU1lc3NhZ2VDaGFpblxuTWVzc2FnZTx8LS1TaW5nbGVNZXNzYWdlXG5cbk1lc3NhZ2VDaGFpbiBvLS0gU2luZ2xlTWVzc2FnZVxuXG5TaW5nbGVNZXNzYWdlPHwtLU1lc3NhZ2VDb250ZW50XG5TaW5nbGVNZXNzYWdlPHwtLU1lc3NhZ2VNZXRhZGF0YVxuXG4iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ" target="_blank" rel="noopener noreferrer"><img src="https://mermaid.ink/img/eyJjb2RlIjoiY2xhc3NEaWFncmFtXG5cbmNsYXNzIE1lc3NhZ2VDaGFpblxuTWVzc2FnZUNoYWluIDogTGlzdH5TaW5nbGVNZXNzYWdlflxuXG5NZXNzYWdlPHwtLU1lc3NhZ2VDaGFpblxuTWVzc2FnZTx8LS1TaW5nbGVNZXNzYWdlXG5cbk1lc3NhZ2VDaGFpbiBvLS0gU2luZ2xlTWVzc2FnZVxuXG5TaW5nbGVNZXNzYWdlPHwtLU1lc3NhZ2VDb250ZW50XG5TaW5nbGVNZXNzYWdlPHwtLU1lc3NhZ2VNZXRhZGF0YVxuXG4iLCJtZXJtYWlkIjp7InRoZW1lIjoiZGVmYXVsdCJ9LCJ1cGRhdGVFZGl0b3IiOmZhbHNlfQ" alt=""><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><code>SingleMessage</code> 表示单个消息元素。<br><code>MessageChain</code>（消息链） 是 <code>List&lt;SingleMessage&gt;</code>。主动发送的消息和从服务器接收消息都是 <code>MessageChain</code>。</p><blockquote><p>回到 <a href="#%E7%9B%AE%E5%BD%95">目录</a></p></blockquote><h2 id="消息类型" tabindex="-1"><a class="header-anchor" href="#消息类型" aria-hidden="true">#</a> 消息类型</h2><p>Mirai 支持富文本消息。</p><p><em>单个消息元素（<code>SingleMessage</code>）</em> 分为 <em>内容（<code>MessageContent</code>）</em> 和 <em>元数据（<code>MessageMetadata</code>）</em>。</p><p>实践中，消息内容和消息元数据会混合存在于消息链中。</p><h3 id="内容" tabindex="-1"><a class="header-anchor" href="#内容" aria-hidden="true">#</a> 内容</h3><p><em>内容（<code>MessageContent</code>）</em> 即为 <em>纯文本</em>、<em>提及某人</em>、<em>图片</em>、<em>语音</em> 和 <em>音乐分享</em> 等<strong>有内容</strong>的数据，一条消息中必须包含内容才能发送。</p><h3 id="元数据" tabindex="-1"><a class="header-anchor" href="#元数据" aria-hidden="true">#</a> 元数据</h3><p><em>元数据（<code>MessageMetadata</code>）</em> 包含 <em>来源</em>、<em>引用回复</em> 和 <em>秀图标识</em> 等。</p><ul><li><em>消息来源</em>（<code>MessageSource</code>）存在于每条消息中，包含唯一识别信息，用于撤回和引用回复的定位。</li><li><em>引用回复</em>（<code>QuoteReply</code>）若存在，则会在客户端中解析为本条消息引用了另一条消息。</li><li><em>秀图标识</em>（<code>ShowImageFlag</code>）若存在，则表明这条消息中的图片是以秀图发送（QQ 的一个功能）。</li></ul><p>元数据与内容的区分就在于，一条消息没有元数据也能显示，但一条消息不能没有内容。<strong>元数据是消息的属性</strong>。</p><p>后文会介绍如何获取元数据。</p><blockquote><p>回到 <a href="#%E7%9B%AE%E5%BD%95">目录</a></p></blockquote><hr><h2 id="消息元素" tabindex="-1"><a class="header-anchor" href="#消息元素" aria-hidden="true">#</a> 消息元素</h2><p>Mirai 支持多种消息类型。</p><p>消息拥有三种转换到字符串的表示方式。</p><table><thead><tr><th style="text-align:left;">方法</th><th style="text-align:left;">解释</th></tr></thead><tbody><tr><td style="text-align:left;"><code>serializeToMiraiCode()</code></td><td style="text-align:left;">对应的 Mirai 码. 消息的一种序列化方式，格式为 <code>[mirai:TYPE:PROP]</code>，其中 <code>TYPE</code> 为消息类型, <code>PROP</code> 为属性</td></tr><tr><td style="text-align:left;"><code>contentToString()</code></td><td style="text-align:left;">QQ 对话框中以纯文本方式会显示的消息内容。无法用纯文字表示的消息会丢失信息，如任何图片都是 <code>[图片]</code></td></tr><tr><td style="text-align:left;"><code>toString()</code></td><td style="text-align:left;">Java 对象的 <code>toString()</code>，会尽可能包含多的信息用于调试作用，<strong>行为可能不确定</strong></td></tr></tbody></table><p>各类型消息元素及其 <code>contentToString()</code> 如下表格所示。</p><table><thead><tr><th style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/SingleMessage.kt" target="_blank" rel="noopener noreferrer"><code>MessageContent</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 类型</th><th style="text-align:left;">解释</th><th style="text-align:left;"><code>contentToString()</code></th><th style="text-align:center;">最低支持的版本</th></tr></thead><tbody><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/PlainText.kt" target="_blank" rel="noopener noreferrer"><code>PlainText</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">纯文本</td><td style="text-align:left;"><code>$content</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Image.kt" target="_blank" rel="noopener noreferrer"><code>Image</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">自定义图片</td><td style="text-align:left;"><code>[图片]</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/At.kt" target="_blank" rel="noopener noreferrer"><code>At</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">提及某人</td><td style="text-align:left;"><code>@$target</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/AtAll.kt" target="_blank" rel="noopener noreferrer"><code>AtAll</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">提及全体成员</td><td style="text-align:left;"><code>@全体成员</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Face.kt" target="_blank" rel="noopener noreferrer"><code>Face</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">原生表情</td><td style="text-align:left;"><code>[表情对应的中文名]</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/FlashImage.kt" target="_blank" rel="noopener noreferrer"><code>FlashImage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">闪照</td><td style="text-align:left;"><code>[闪照]</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/PokeMessage.kt" target="_blank" rel="noopener noreferrer"><code>PokeMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">戳一戳消息（消息非动作）</td><td style="text-align:left;"><code>[戳一戳]</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/VipFace.kt" target="_blank" rel="noopener noreferrer"><code>VipFace</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">VIP 表情</td><td style="text-align:left;"><code>[${kind.name}]x$count</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/RichMessage.kt" target="_blank" rel="noopener noreferrer"><code>LightApp</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">小程序</td><td style="text-align:left;"><code>$content</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Voice.kt" target="_blank" rel="noopener noreferrer"><code>Voice</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">语音（已弃用）</td><td style="text-align:left;"><code>[语音消息]</code></td><td style="text-align:center;">2.0 <em><sup>(3)</sup></em></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MarketFace.kt" target="_blank" rel="noopener noreferrer"><code>MarketFace</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">商城表情</td><td style="text-align:left;"><code>[表情对应的中文名]</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/ForwardMessage.kt" target="_blank" rel="noopener noreferrer"><code>ForwardMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">合并转发</td><td style="text-align:left;"><code>[转发消息]</code></td><td style="text-align:center;">2.0 <em><sup>(1)</sup></em></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/RichMessage.kt" target="_blank" rel="noopener noreferrer"><code>SimpleServiceMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">（不稳定）服务消息</td><td style="text-align:left;"><code>$content</code></td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MusicShare.kt" target="_blank" rel="noopener noreferrer"><code>MusicShare</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">音乐分享</td><td style="text-align:left;"><code>[分享]曲名</code></td><td style="text-align:center;">2.1</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Dice.kt" target="_blank" rel="noopener noreferrer"><code>Dice</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">魔法表情骰子</td><td style="text-align:left;"><code>[骰子:$value]</code></td><td style="text-align:center;">2.5</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/FileMessage.kt" target="_blank" rel="noopener noreferrer"><code>FileMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">文件消息</td><td style="text-align:left;"><code>[文件]文件名称</code></td><td style="text-align:center;">2.5</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Audio.kt" target="_blank" rel="noopener noreferrer"><code>Audio</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">语音</td><td style="text-align:left;"><code>[语音消息]</code></td><td style="text-align:center;">2.7</td></tr></tbody></table><table><thead><tr><th style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/SingleMessage.kt" target="_blank" rel="noopener noreferrer"><code>MessageMetadata</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 类型</th><th style="text-align:left;">解释</th><th style="text-align:center;">最低支持的版本</th></tr></thead><tbody><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageSource.kt" target="_blank" rel="noopener noreferrer"><code>MessageSource</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">消息来源元数据</td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/QuoteReply.kt" target="_blank" rel="noopener noreferrer"><code>QuoteReply</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">引用回复</td><td style="text-align:center;">2.0</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/ShowImageFlag.kt" target="_blank" rel="noopener noreferrer"><code>ShowImageFlag</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">秀图标识</td><td style="text-align:center;">2.2</td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageOrigin.kt" target="_blank" rel="noopener noreferrer"><code>RichMessageOrigin</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">富文本消息源</td><td style="text-align:center;">2.3 <em><sup>(2)</sup></em></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageOrigin.kt" target="_blank" rel="noopener noreferrer"><code>MessageOrigin</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;">富文本消息源</td><td style="text-align:center;">2.6</td></tr></tbody></table><blockquote><p><em>(1):</em> <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/ForwardMessage.kt" target="_blank" rel="noopener noreferrer"><code>ForwardMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 在 2.0 支持发送, 在 2.3 支持接收<br><em>(2):</em> <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageOrigin.kt" target="_blank" rel="noopener noreferrer"><code>RichMessageOrigin</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 在 2.3 增加, 在 2.6 弃用并以 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageOrigin.kt" target="_blank" rel="noopener noreferrer"><code>MessageOrigin</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 替换<br><em>(3):</em> <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Voice.kt" target="_blank" rel="noopener noreferrer"><code>Voice</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 在 2.0 增加, 在 2.7 弃用并以 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Audio.kt" target="_blank" rel="noopener noreferrer"><code>Audio</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 替换</p></blockquote><h3 id="用法" tabindex="-1"><a class="header-anchor" href="#用法" aria-hidden="true">#</a> 用法</h3><p>只需要得到各种类型 <code>Message</code> 的实例就可以使用，可以直接发送（<code>Contact.sendMessage</code>）也可以连接到消息链中（<code>Message.plus</code>）。</p><p>可在上文表格中找到需要的类型并在源码内文档获取更多实践上的帮助。</p><blockquote><p>回到 <a href="#%E7%9B%AE%E5%BD%95">目录</a></p></blockquote><h2 id="消息链" tabindex="-1"><a class="header-anchor" href="#消息链" aria-hidden="true">#</a> 消息链</h2><p>前文已经介绍消息链，这里简略介绍消息链的使用。详细的使用请查看源码内注释。</p><h3 id="发送消息" tabindex="-1"><a class="header-anchor" href="#发送消息" aria-hidden="true">#</a> 发送消息</h3><p>在 <a href="/Contacts.html" class="">Contacts 章节</a> 提到，要发送消息使用 <code>Contact.sendMessage</code>。<code>Contact.sendMessage</code> 的定义是：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code> <span class="token keyword">suspend</span> <span class="token keyword">fun</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> Message<span class="token punctuation">)</span><span class="token operator">:</span> MessageReceipt<span class="token operator">&lt;</span>Contact<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>要发送字符串消息，使用：（第一部分是 Kotlin，随后是 Java，下同）</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code>contact<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Hello!&quot;</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>contact<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>发送字符串实际上是在发送纯文本消息。上面的代码相当于：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code>contact<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token function">PlainText</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;Hello!&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>contact<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlainText</span><span class="token punctuation">(</span><span class="token string">&quot;Hello!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>要发送多元素消息，可将消息使用 <code>plus</code> 操作连接：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code>contact<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token function">PlainText</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;你要的图片是&quot;</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">Image</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;{f8f1ab55-bf8e-4236-b55e-955848d7069f}.png&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 一个纯文本加一个图片</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>contact<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlainText</span><span class="token punctuation">(</span><span class="token string">&quot;你要的图片是：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span><span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token function">fromId</span><span class="token punctuation">(</span><span class="token string">&quot;{f8f1ab55-bf8e-4236-b55e-955848d7069f}.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一个纯文本加一个图片</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注当需要拼接的消息元素较多时，建议<a href="#%E6%9E%84%E9%80%A0%E6%B6%88%E6%81%AF%E9%93%BE">使用构建器</a>。</p><p>在 mirai 2.12 起，<code>plus</code> 在不同时涉及消息链以及元数据时，速度与构建器相当。而在这以前 <code>plus</code> 在很多情况下都比使用构建器慢。（备注：只要不是要连接数百个或更多元素，这个性能差距实际上也可以忽略）</p><h3 id="构造消息链" tabindex="-1"><a class="header-anchor" href="#构造消息链" aria-hidden="true">#</a> 构造消息链</h3><p>多个消息元素可以作为消息链组合。</p><h4 id="在-kotlin-构造消息链" tabindex="-1"><a class="header-anchor" href="#在-kotlin-构造消息链" aria-hidden="true">#</a> 在 Kotlin 构造消息链</h4><table><thead><tr><th style="text-align:left;">定义</th></tr></thead><tbody><tr><td style="text-align:left;"><code>fun Iterable&lt;Messaged&gt;.toMessageChain(): MessageChain</code></td></tr><tr><td style="text-align:left;"><code>fun Sequence&lt;Messaged&gt;.toMessageChain(): MessageChain</code></td></tr><tr><td style="text-align:left;"><code>fun Array&lt;Message&gt;.toMessageChain(): MessageChain</code></td></tr><tr><td style="text-align:left;"><code>fun Message.toMessageChain(): MessageChain</code></td></tr><tr><td style="text-align:left;"><code>fun messageChainOf(vararg Message): MessageChain</code></td></tr><tr><td style="text-align:left;"><code>fun Message.plus(tail: Message): MessageChain</code></td></tr></tbody></table><p>可以使用如上表格所示的方法构造，或使用 DSL 构建器。构建器的简单定义如下：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">class</span> MessageChainBuilder <span class="token operator">:</span> MutableList<span class="token operator">&lt;</span>SingleMessage<span class="token operator">&gt;</span><span class="token punctuation">,</span> Appendable <span class="token punctuation">{</span>
    <span class="token keyword">operator</span> <span class="token keyword">fun</span> Message<span class="token punctuation">.</span><span class="token function">unaryPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">operator</span> <span class="token keyword">fun</span> String<span class="token punctuation">.</span><span class="token function">unaryPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">fun</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">vararg</span> messages<span class="token operator">:</span> Message<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 Kotlin 的使用示例：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> chain <span class="token operator">=</span> buildMessageChain <span class="token punctuation">{</span>
    <span class="token operator">+</span><span class="token function">PlainText</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;a&quot;</span></span><span class="token punctuation">)</span>
    <span class="token operator">+</span>AtAll
    <span class="token operator">+</span><span class="token function">Image</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;/f8f1ab55-bf8e-4236-b55e-955848d7069f&quot;</span></span><span class="token punctuation">)</span>
    <span class="token function">add</span><span class="token punctuation">(</span><span class="token function">At</span><span class="token punctuation">(</span><span class="token number">123456</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// `+` 和 `add` 作用相同</span>
<span class="token punctuation">}</span>

<span class="token comment">// chain 结果是包含 PlainText, AtAll, Image, At 的 MessageChain</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该示例中 <code>+</code> 是位于 <code>MessageChainBuilder</code> 的 <code>Message.unaryPlus</code> 扩展。使用 <code>+</code> 和使用 <code>add</code> 是相等的。</p><h4 id="在-java-构造消息链" tabindex="-1"><a class="header-anchor" href="#在-java-构造消息链" aria-hidden="true">#</a> 在 Java 构造消息链</h4><table><thead><tr><th style="text-align:left;">定义</th></tr></thead><tbody><tr><td style="text-align:left;"><code>public static MessageChain newChain(Iterable&lt;Message&gt; iterable)</code></td></tr><tr><td style="text-align:left;"><code>public static MessageChain newChain(Message iterable...)</code></td></tr><tr><td style="text-align:left;"><code>public static MessageChain newChain(Iterator&lt;Message&gt; iterable...)</code></td></tr></tbody></table><p>方法都位于 <code>net.mamoe.mirai.message.data.MessageUtils</code>。</p><p>使用 <code>newChain</code>：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MessageChain</span> chain <span class="token operator">=</span> <span class="token class-name">MessageUtils</span><span class="token punctuation">.</span><span class="token function">newChain</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlainText</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token function">fromId</span><span class="token punctuation">(</span><span class="token string">&quot;{f8f1ab55-bf8e-4236-b55e-955848d7069f}.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>使用 <code>MessageChainBuilder</code>:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MessageChain</span> chain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChainBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlainText</span><span class="token punctuation">(</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 会被构造成 PlainText 再添加, 相当于上一行</span>
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">AtAll</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token function">fromId</span><span class="token punctuation">(</span><span class="token string">&quot;{f8f1ab55-bf8e-4236-b55e-955848d7069f}.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="作为字符串处理消息" tabindex="-1"><a class="header-anchor" href="#作为字符串处理消息" aria-hidden="true">#</a> 作为字符串处理消息</h3><p>通常要把消息作为字符串处理，可在 Kotlin 使用 <code>message.content</code> 或在 Java 使用 <code>message.contentToString()</code>。 获取到的字符串表示只包含各 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/SingleMessage.kt" target="_blank" rel="noopener noreferrer"><code>MessageContent</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 以官方风格显示的消息内容。如 <code>&quot;你本次测试的成绩是[图片]&quot;</code>、<code>[语音]</code>、<code>[微笑]</code>。</p><p>使用 <code>toString()</code> 对某些元素可以获得与 <code>contentToString()</code> 相似的结果，但 <strong><code>toString</code> 是不稳定</strong>的，可能在未来版本变更。 <code>contentToString()</code> 实际上也<strong>没有</strong>对所有元素都作出稳定性承诺，在开发时应尽可能避免基于复杂消息类型的字符串表示处理。</p><h3 id="处理富文本消息" tabindex="-1"><a class="header-anchor" href="#处理富文本消息" aria-hidden="true">#</a> 处理富文本消息</h3><p>Mirai 不内置富文本消息的处理工具类。<code>MessageChain</code> 实现接口 <code>List&lt;SingleMessage&gt;</code>，一个思路是遍历 list 并判断类型处理：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">for</span> <span class="token punctuation">(</span>element <span class="token operator">:</span> messageChain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token keyword">instanceof</span> <span class="token class-name">Image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理一个 Image</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以像数组一样按下标随机访问：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SingleMessage</span> element <span class="token operator">=</span> messageChain<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>element <span class="token keyword">instanceof</span> <span class="token class-name">Image</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 处理一个 Image</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="元素唯一性" tabindex="-1"><a class="header-anchor" href="#元素唯一性" aria-hidden="true">#</a> 元素唯一性</h3><p>部分元素只能单一存在于消息链中。这样的元素实现接口 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/ConstrainSingle.kt" target="_blank" rel="noopener noreferrer"><code>ConstrainSingle</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><p>唯一的元素例如 <em>消息元数据</em> <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageSource.kt" target="_blank" rel="noopener noreferrer"><code>MessageSource</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，在连接时，新的（右侧）元素会替换旧的（左侧）元素。如：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> source1<span class="token operator">:</span> MessageSource
<span class="token keyword">val</span> source2<span class="token operator">:</span> MessageSource

<span class="token keyword">val</span> chain<span class="token operator">:</span> MessageChain <span class="token operator">=</span> source1 <span class="token operator">+</span> source2
<span class="token comment">// 结果 chain 只包含一个元素，即右侧的 source2。</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>元素唯一性的识别基于 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageKey.kt" target="_blank" rel="noopener noreferrer"><code>MessageKey</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。有些 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageKey.kt" target="_blank" rel="noopener noreferrer"><code>MessageKey</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 拥有多态机制。例如 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/HummerMessage.kt" target="_blank" rel="noopener noreferrer"><code>HummerMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的继承关系</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>              MessageContent
                    ↑
              HummerMessage
                    ↑
       +------------+-------------+------------+
       |            |             |            |
 PokeMessage     VipFace      FlashImage      ...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当连接一个 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/VipFace.kt" target="_blank" rel="noopener noreferrer"><code>VipFace</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 到一个 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageChain.kt" target="_blank" rel="noopener noreferrer"><code>MessageChain</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 时，由于 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/VipFace.kt" target="_blank" rel="noopener noreferrer"><code>VipFace</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 最远父类为 <code>MessageContent</code>，消息链中第一个 <code>MessageContent</code> 会被（保留顺序地）替换为 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/VipFace.kt" target="_blank" rel="noopener noreferrer"><code>VipFace</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>，其他所有 <code>MessageContent</code> 都会被删除。</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Kotlin</span>

<span class="token keyword">val</span> face <span class="token operator">=</span> <span class="token function">VipFace</span><span class="token punctuation">(</span>VipFace<span class="token punctuation">.</span>AiXin<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// VipFace 是 ConstrainSingle</span>
<span class="token keyword">val</span> chain <span class="token operator">=</span> <span class="token function">messageChainOf</span><span class="token punctuation">(</span>plainText<span class="token punctuation">,</span> quoteReply<span class="token punctuation">,</span> at<span class="token punctuation">,</span> atAll<span class="token punctuation">)</span> <span class="token comment">// quoteReply 是 MessageMetadata, 其他三个都是 MessageContent</span>
<span class="token keyword">val</span> result <span class="token operator">=</span> chain <span class="token operator">+</span> face <span class="token comment">// 右侧的 VipFace 替换掉所有的 MessageContent. 它会存在于第一个 MessageContent 位置.</span>
<span class="token comment">// 结果为 [VipFace, QuoteReply]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Java</span>

<span class="token class-name">VipFace</span> face <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VipFace</span><span class="token punctuation">(</span><span class="token class-name">VipFace<span class="token punctuation">.</span>AiXin</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// VipFace 是 ConstrainSingle</span>
<span class="token class-name">MessageChain</span> chain <span class="token operator">=</span> <span class="token class-name">MessageChain</span><span class="token punctuation">.</span><span class="token function">newChain</span><span class="token punctuation">(</span>plainText<span class="token punctuation">,</span> quoteReply<span class="token punctuation">,</span> at<span class="token punctuation">,</span> atAll<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// quoteReply 是 MessageMetadata, 其他三个都是 MessageContent</span>
<span class="token class-name">MessageChain</span> result <span class="token operator">=</span> chain<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>face<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 右侧的 VipFace 替换掉所有的 MessageContent. 它会存在于第一个 MessageContent 位置.</span>
<span class="token comment">// 结果为 [VipFace, QuoteReply]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>简单来说，这符合现实的逻辑：一条消息如果包含了语音，就不能同时包含群文件、提及全体成员、文字内容等元素。进行 <code>chain.plus(audio)</code> 时，如果消息内容冲突则会发生替换，且总是右侧元素替换左侧元素。<br> 而如果消息可以同时存在，比如一个纯文本和一个或多个图片相连 <code>plainText.plus(image1).plus(image2)</code> 时没有冲突，不会发生替换。结果将会是 <code>[PlainText, Image, Image]</code> 的 <code>MessageChain</code>。</p><h3 id="获取消息链中的消息元素" tabindex="-1"><a class="header-anchor" href="#获取消息链中的消息元素" aria-hidden="true">#</a> 获取消息链中的消息元素</h3><h4 id="a-筛选-list" tabindex="-1"><a class="header-anchor" href="#a-筛选-list" aria-hidden="true">#</a> A. 筛选 List</h4><p><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageChain.kt" target="_blank" rel="noopener noreferrer"><code>MessageChain</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 继承接口 <code>List&lt;SingleMessage&gt;</code>。</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token operator">=</span> chain<span class="token punctuation">.</span>findIsInstance<span class="token operator">&lt;</span>Image<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Image</span> image <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Image</span><span class="token punctuation">)</span> chain<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">Image</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token operator">::</span><span class="token function">isInstance</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在 Kotlin 要获取第一个指定类型实例还可以使用快捷扩展。</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token operator">=</span> chain<span class="token punctuation">.</span>findIsInstance<span class="token operator">&lt;</span>Image<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> image<span class="token operator">:</span> Image <span class="token operator">=</span> chain<span class="token punctuation">.</span>firstIsInstance<span class="token operator">&lt;</span>Image<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 不存在时 NoSuchElementException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="b-获取唯一元素" tabindex="-1"><a class="header-anchor" href="#b-获取唯一元素" aria-hidden="true">#</a> B. 获取唯一元素</h4><p>如果要获取 <code>ConstrainSingle</code> 的消息元素，可以快速通过键获得。</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> quote<span class="token operator">:</span> QuoteReply<span class="token operator">?</span> <span class="token operator">=</span> chain<span class="token punctuation">[</span>QuoteReply<span class="token punctuation">]</span> <span class="token comment">// 类似 Map.get</span>
<span class="token keyword">val</span> quote<span class="token operator">:</span> QuoteReply <span class="token operator">=</span> chain<span class="token punctuation">.</span><span class="token function">getOrFail</span><span class="token punctuation">(</span>QuoteReply<span class="token punctuation">)</span> <span class="token comment">// 不存在时 NoSuchElementException</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">QuoteReply</span> quote <span class="token operator">=</span> chain<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">QuoteReply<span class="token punctuation">.</span>Key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>一些元数据就可以通过这个方法获得。如上述示例就是在获取引用回复（<code>QuoteReply</code>）。如果获取不为 <code>null</code> 则表明这条消息包含对其他某条消息的引用。</p><blockquote><p>这是因为 <code>MessageKey</code> 一般都以消息元素的 <code>companion object</code> 实现</p></blockquote><h4 id="c-使用属性委托" tabindex="-1"><a class="header-anchor" href="#c-使用属性委托" aria-hidden="true">#</a> C. 使用属性委托</h4><p>可在 Kotlin 使用属性委托。这样的方法与上述方法在性能上等价。</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> image<span class="token operator">:</span> Image <span class="token keyword">by</span> chain <span class="token comment">// 不存在时 NoSuchElementException</span>
<span class="token keyword">val</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token keyword">by</span> chain<span class="token punctuation">.</span><span class="token function">orNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> image<span class="token operator">:</span> Image<span class="token operator">?</span> <span class="token keyword">by</span> chain<span class="token punctuation">.</span><span class="token function">orElse</span> <span class="token punctuation">{</span> <span class="token comment">/* 返回一个 Image */</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="d-遍历-list" tabindex="-1"><a class="header-anchor" href="#d-遍历-list" aria-hidden="true">#</a> D. 遍历 List</h4><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SingleMessage</span> message <span class="token operator">:</span> messageChain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...    </span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以使用 <code>messageChain.iterator()</code>、 <code>messageChain.stream()</code> 等。</p><h3 id="序列化" tabindex="-1"><a class="header-anchor" href="#序列化" aria-hidden="true">#</a> 序列化</h3><blockquote><p>简单地讲，序列化指的是将内存中的对象转换为其他易于存储等的表示方式。如对象变 JSON 字符串、对象变 MiraiCode 字符串。</p></blockquote><p>消息可以序列化为 JSON 字符串，使用 <code>MessageChain.serializeToJsonString</code> 和 <code>MessageChain.deserializeFromJsonString</code>。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token class-name">MessageChain</span><span class="token punctuation">.</span><span class="token function">serializeToJsonString</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">MessageChain</span> chain <span class="token operator">=</span> <span class="token class-name">MessageChain</span><span class="token punctuation">.</span><span class="token function">deserializeFromJsonString</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="使用-kotlinx-serialization" tabindex="-1"><a class="header-anchor" href="#使用-kotlinx-serialization" aria-hidden="true">#</a> 使用 kotlinx.serialization</h4><p>若要将消息类型使用在其他类型中，如</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">Foo</span><span class="token punctuation">(</span>
    <span class="token keyword">val</span> image<span class="token operator">:</span> Image
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>则需要在序列化时为 format 添加 <code>serializersModule</code>：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> json <span class="token operator">=</span> Json <span class="token punctuation">{</span>
    serializersModule <span class="token operator">=</span> MessageSerializers<span class="token punctuation">.</span>serializersModule
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果遇到 <a href="https://github.com/mamoe/mirai/issues/1273#issuecomment-850997979" target="_blank" rel="noopener noreferrer"><code>Encountered unknown key &#39;type&#39;.</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 等序列化错误，请添加：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code>Json <span class="token punctuation">{</span>
    serializersModule <span class="token operator">=</span> MessageSerializers<span class="token punctuation">.</span>serializersModule
    ignoreUnknownKeys <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 添加这一行</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="元素类型不一定被保留" tabindex="-1"><a class="header-anchor" href="#元素类型不一定被保留" aria-hidden="true">#</a> 元素类型不一定被保留</h4><p>如 <em>消息源 <code>MessageSource</code></em> 有 <em>在线消息源 <code>OnlineMessageSource</code></em> 和 <em>离线消息源 <code>OfflineMessageSource</code></em> 之分。<code>OnlineMessageSource</code> 在序列化并反序列化后会变为 <code>OfflineMessageSource</code>，因为在线消息源只能从消息回执和消息事件中的 <code>MessageChain</code> 得到。</p><p>但在 API 使用上不会有区别（共有属性获取到的值不会变化）。只是可能需要注意 <code>equals</code> 等方法的使用。</p><p>所有 <code>Message</code> 反序列化的结果都是 <code>MessageChain</code>，即使原消息可能是 <code>SingleMessage</code>。如果原消息是 <code>SingleMessage</code>，可在反序列化后通过 <code>chian.get(0)</code> 下标访问并强转类型（或者其他更好的方法）。</p><h4 id="序列化稳定性" tabindex="-1"><a class="header-anchor" href="#序列化稳定性" aria-hidden="true">#</a> 序列化稳定性</h4><p>在旧版本产生的 JSON 字符串在绝大多数情况下可以由新版本 Mirai 读取并反序列化成原 <code>MessageChain</code>。如果更新时放弃了对某个旧版本消息元素的支持，将会在更新日志中说明。</p><p>但这个规则不适用于 <em>实验性特性</em>（带有 <code>@MiraiExperimentalApi</code> 注解）。任何使用了实验性特性的消息元素都随时可变。</p><h3 id="消息的其他常用功能" tabindex="-1"><a class="header-anchor" href="#消息的其他常用功能" aria-hidden="true">#</a> 消息的其他常用功能</h3><h4 id="撤回自己或群员的消息" tabindex="-1"><a class="header-anchor" href="#撤回自己或群员的消息" aria-hidden="true">#</a> 撤回自己或群员的消息</h4><p>撤回的核心操作是 <code>MessageSource.recall</code>。 如果操作目标 <code>MessageSource</code> 指代的是自己的消息，那么就撤回该消息，操作群员消息同理。</p><p>来自 <code>GroupMessageEvent</code> 等消息事件的属性 <code>message</code> 的 <code>MessageChain</code> 都包含 <code>MessageSource</code> 元素，指代这条消息本身。那么就可以用来撤回这条消息。</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Kotlin</span>
messageSource<span class="token punctuation">.</span><span class="token function">recall</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
messageChain<span class="token punctuation">.</span><span class="token function">recall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 获取其中 MessageSource 元素并操作 recall </span>

messageSource<span class="token punctuation">.</span><span class="token function">recallIn</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span> <span class="token comment">// 启动协程, 3 秒后撤回消息. 返回的 AsyncRecallResult 可以获取结果</span>
messageChain<span class="token punctuation">.</span><span class="token function">recallIn</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Java</span>
<span class="token class-name">MessageSource</span><span class="token punctuation">.</span><span class="token function">recall</span><span class="token punctuation">(</span>messageSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">MessageSource</span><span class="token punctuation">.</span><span class="token function">recall</span><span class="token punctuation">(</span>messageChain<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取其中 MessageSource 元素并操作 recall </span>

<span class="token class-name">MessageSource</span><span class="token punctuation">.</span><span class="token function">recallIn</span><span class="token punctuation">(</span>messageSource<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span> <span class="token comment">// 启动异步任务, 3 秒后撤回消息. 返回的 AsyncRecallResult 可以获取结果</span>
<span class="token class-name">MessageSource</span><span class="token punctuation">.</span><span class="token function">recallIn</span><span class="token punctuation">(</span>messageChain<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="发送带有引用回复的消息" tabindex="-1"><a class="header-anchor" href="#发送带有引用回复的消息" aria-hidden="true">#</a> 发送带有引用回复的消息</h4><p>引用回复 <code>QuoteReply</code> 是一个元数据 <code>MessageMetadata</code>。将 <code>QuoteReply</code> 实例连接到消息链中，发送后的消息就会引用一条其他消息。</p><p>例如监听事件并回复一条群消息：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token comment">// Kotlin</span>
bot<span class="token punctuation">.</span>eventChannel<span class="token punctuation">.</span>subscribeAlways<span class="token operator">&lt;</span>GroupMessageEvent<span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// this: GroupMessageEvent</span>
    subject<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">quote</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string-literal singleline"><span class="token string">&quot;Hi!&quot;</span></span><span class="token punctuation">)</span> <span class="token comment">// 引用收到的消息并回复 &quot;Hi!&quot;, 也可以添加图片等更多元素.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Java</span>
bot<span class="token punctuation">.</span><span class="token function">getEventChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>subscribeAlways<span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">GroupMessageEvent</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>event <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token class-name">MessageChain</span> chain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChainBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 引用收到的消息并回复 &quot;Hi!&quot;, 也可以添加图片等更多元素.</span>
        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QuoteReply</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Hi!&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    event<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>chain<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="更多消息类型" tabindex="-1"><a class="header-anchor" href="#更多消息类型" aria-hidden="true">#</a> 更多消息类型</h4><p>在 <a href="#%E6%B6%88%E6%81%AF%E5%85%83%E7%B4%A0">消息元素</a> 表格中找到你需要的消息元素，然后到源码内注释查看相应的用法说明。</p><blockquote><p>回到 <a href="#%E7%9B%AE%E5%BD%95">目录</a></p></blockquote><hr><h2 id="mirai-码" tabindex="-1"><a class="header-anchor" href="#mirai-码" aria-hidden="true">#</a> Mirai 码</h2><p>实现了接口 <code>CodableMessage</code> 的消息类型支持 mirai 码表示。可以在<a href="#%E7%94%B1-codablemessage-%E5%8F%96%E5%BE%97-mirai-%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2">下文</a>找到这些消息类型的列表。</p><h3 id="转义规则" tabindex="-1"><a class="header-anchor" href="#转义规则" aria-hidden="true">#</a> 转义规则</h3><p>mirai 码内的属性字符串会被转义。</p><table><thead><tr><th style="text-align:center;">原字符</th><th style="text-align:center;">转义结果字符</th></tr></thead><tbody><tr><td style="text-align:center;"><code>[</code></td><td style="text-align:center;"><code>\[</code></td></tr><tr><td style="text-align:center;"><code>]</code></td><td style="text-align:center;"><code>\]</code></td></tr><tr><td style="text-align:center;"><code>:</code></td><td style="text-align:center;"><code>\:</code></td></tr><tr><td style="text-align:center;"><code>,</code></td><td style="text-align:center;"><code>\,</code></td></tr><tr><td style="text-align:center;"><code>\</code></td><td style="text-align:center;"><code>\\</code></td></tr><tr><td style="text-align:center;"><em>换行符 \n</em></td><td style="text-align:center;"><code>\n</code></td></tr><tr><td style="text-align:center;"><em>换行符 \r</em></td><td style="text-align:center;"><code>\r</code></td></tr></tbody></table><h3 id="组成约定" tabindex="-1"><a class="header-anchor" href="#组成约定" aria-hidden="true">#</a> 组成约定</h3><p>一个有效的 mirai 码 (如 <code>[mirai:atall]</code> (无参数), <code>[mirai:at:123]</code> (有参数)) 可分为以下几个组成部分</p><ul><li><code>[mirai:</code> 固定开头</li><li>消息类型， 如 <code>at</code></li><li>消息参数 <ul><li><code>:</code> 固定分隔符</li><li>参数内容 <strong>(需要进行转义)</strong></li></ul></li><li><code>]</code> 固定结尾</li></ul><h4 id="为何需要进行转义" tabindex="-1"><a class="header-anchor" href="#为何需要进行转义" aria-hidden="true">#</a> 为何需要进行转义</h4><p>为了 mirai 码的正确解析, 不转义无法正确解析原本意义</p><p>假如有以下参数</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>{&quot;msg&quot;: [1, 2, 3]}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果不进行转义直接进行 mirai 码拼接 (如: <code>[mirai:msg:{&quot;msg&quot;: [1, 2, 3]}]</code>), 那么 mirai 码会被错误解析</p><blockquote><p>解析结果如下:</p><ul><li>mirai 码 <code>[mirai:msg:{&quot;msg&quot;: [1, 2, 3]</code></li><li>纯文本 <code>}]</code></li></ul></blockquote><h3 id="消息链的-mirai-码" tabindex="-1"><a class="header-anchor" href="#消息链的-mirai-码" aria-hidden="true">#</a> 消息链的 mirai 码</h3><p>消息链 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageChain.kt" target="_blank" rel="noopener noreferrer"><code>MessageChain</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 是多个 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/SingleMessage.kt" target="_blank" rel="noopener noreferrer"><code>SingleMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 的集合。<a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MessageChain.kt" target="_blank" rel="noopener noreferrer"><code>MessageChain</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 也实现 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/code/CodableMessage.kt" target="_blank" rel="noopener noreferrer"><code>CodableMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。在转换为 mirai 码时所有 <a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/code/CodableMessage.kt" target="_blank" rel="noopener noreferrer"><code>CodableMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 直接相连：</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>val chain = messageChainOf(PlainText(&quot;plain&quot;), At(123), AtAll)

chain.serializeToMiraiCode() // &quot;plain[mirai:at:123][mirai:atall]&quot;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="由-codablemessage-取得-mirai-码字符串" tabindex="-1"><a class="header-anchor" href="#由-codablemessage-取得-mirai-码字符串" aria-hidden="true">#</a> 由 <code>CodableMessage</code> 取得 mirai 码字符串</h3><p>通过 <code>CodableMessage.serializeToMiraiCode()</code>。</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>val at = At(123)

at.serializeToMiraiCode() // 结果为 `[mirai:at:123]`
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:center;">消息类型</th><th style="text-align:left;"><code>serializeToMiraiCode()</code></th></tr></thead><tbody><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/PlainText.kt" target="_blank" rel="noopener noreferrer"><code>PlainText</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>$content</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Image.kt" target="_blank" rel="noopener noreferrer"><code>Image</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:image:$imageId]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/At.kt" target="_blank" rel="noopener noreferrer"><code>At</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:at:$target]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/AtAll.kt" target="_blank" rel="noopener noreferrer"><code>AtAll</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:atall]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Face.kt" target="_blank" rel="noopener noreferrer"><code>Face</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:face:id]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/FlashImage.kt" target="_blank" rel="noopener noreferrer"><code>FlashImage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:flash:${image.imageId}]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/PokeMessage.kt" target="_blank" rel="noopener noreferrer"><code>PokeMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:poke:$name,$pokeType,$id]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/VipFace.kt" target="_blank" rel="noopener noreferrer"><code>VipFace</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:vipface:${kind.id},${kind.name},$count]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/RichMessage.kt" target="_blank" rel="noopener noreferrer"><code>LightApp</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:app:$content]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/RichMessage.kt" target="_blank" rel="noopener noreferrer"><code>SimpleServiceMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:service:$serviceId,$content]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/Dice.kt" target="_blank" rel="noopener noreferrer"><code>Dice</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:dice:$value]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/MusicShare.kt" target="_blank" rel="noopener noreferrer"><code>MusicShare</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:musicshare:$args]</code></td></tr><tr><td style="text-align:center;"><a href="https://github.com/mamoe/mirai/blob/dev/mirai-core-api/src/commonMain/kotlin/message/data/FileMessage.kt" target="_blank" rel="noopener noreferrer"><code>FileMessage</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></td><td style="text-align:left;"><code>[mirai:file:$id,$internalId,$name,$size]</code></td></tr></tbody></table><h3 id="由-mirai-码字符串取得-messagechain-实例" tabindex="-1"><a class="header-anchor" href="#由-mirai-码字符串取得-messagechain-实例" aria-hidden="true">#</a> 由 mirai 码字符串取得 <code>MessageChain</code> 实例</h3><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token keyword">val</span> chain <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;[mirai:atall]&quot;</span></span><span class="token punctuation">.</span><span class="token function">deserializeMiraiCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MessageChain</span> chain <span class="token operator">=</span> <span class="token class-name">MiraiCode</span><span class="token punctuation">.</span><span class="token function">deserializeFromMiraiCode</span><span class="token punctuation">(</span><span class="token string">&quot;[mirai:atall]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="转义字符串" tabindex="-1"><a class="header-anchor" href="#转义字符串" aria-hidden="true">#</a> 转义字符串</h3><p>若要执行转义（一般没有必要手动这么做）：</p><div class="language-kotlin ext-kt line-numbers-mode"><pre class="language-kotlin"><code><span class="token function">PlainText</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;[mirai:atall]&quot;</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">serializeToMiraiCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// \[mirai\:atall\]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MiraiCode</span><span class="token punctuation">.</span><span class="token function">serializeToMiraiCode</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PlainText</span><span class="token punctuation">(</span><span class="token string">&quot;[mirai:atall]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// \[mirai\:atall\]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="serializetomiraicode-与-tostring-的区别" tabindex="-1"><a class="header-anchor" href="#serializetomiraicode-与-tostring-的区别" aria-hidden="true">#</a> <code>serializeToMiraiCode</code> 与 <code>toString</code> 的区别</h3><ul><li>如 <a href="#%E6%B6%88%E6%81%AF%E5%85%83%E7%B4%A0">消息元素</a> 所示, <code>toString()</code> 会尽可能包含多的信息用于调试作用，<strong>行为可能不确定</strong></li><li><code>toString()</code> 偏人类可读, <code>serializeToMiraiCode()</code> 偏机器可读</li><li><code>toString()</code> <strong>没有转义</strong>, <code>serializeToMiraiCode()</code> 有正确转义</li><li><code>serializeToMiraiCode()</code> 会跳过 <code>不支持 mirai 码处理</code> 的元素</li><li><code>toString()</code> 基本不可用于 <code>deserializeMiraiCode</code>/<code>MiraiCode.deserializeFromMiraiCode</code></li></ul><hr><p>到这里，你已经完成了 Mirai 所有文档的阅读。现在你已经熟悉了 Mirai，并可以开始使用了。</p><p>你可以首先构造 Bot，登录，然后从监听事件起开始创建你的机器人，或从 Bot 获取到指定群主动发送消息。在使用中遇到问题可以参考 Mirai 源码内注释，该注释会包含更多实践上的帮助。</p><p>如果你仍然对 Mirai 架构有不明确的地方，欢迎在 <a href="https://github.com/mamoe/mirai/discussions/848" target="_blank" rel="noopener noreferrer">#848<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 提出建议，或者直接在 PR 提交你的修改。</p><blockquote><p>回到 <a href="#%E7%9B%AE%E5%BD%95">目录</a></p><p><a href="/CoreAPI.html" class="">回到 Mirai 文档索引</a></p></blockquote></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.ea07c51d.js" defer></script>
  </body>
</html>
